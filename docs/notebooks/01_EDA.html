<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>01: Exploratory Data Analysis – Rossmann Store Sales</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-89a4c75c28f39d544352a2d30bce53fa.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-sidebar docked nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Rossmann Store Sales</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../index.html" aria-current="page"> 
<span class="menu-text">Project Overview</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-notebooks" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Notebooks</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-notebooks">    
        <li>
    <a class="dropdown-item" href="../notebooks/01_EDA.html">
 <span class="dropdown-text">EDA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/02_Modeling.html">
 <span class="dropdown-text">Modeling</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../Final_Report.html"> 
<span class="menu-text">Final Report</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://public.tableau.com/views/RossmannSalesDashboard/RossmannStoreSalesDashboard?:language=en-US&amp;publish=yes&amp;:sid=&amp;:redirect=auth&amp;:display_count=n&amp;:origin=viz_share_link"> 
<span class="menu-text">Dashboard</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../notebooks/01_EDA.html">Notebooks</a></li><li class="breadcrumb-item"><a href="../notebooks/01_EDA.html">EDA</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Project Overview</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Notebooks</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/01_EDA.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">EDA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/02_Modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modeling</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Final_Report.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Final Report</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://public.tableau.com/views/RossmannSalesDashboard/RossmannStoreSalesDashboard?:language=en-US&amp;publish=yes&amp;:sid=&amp;:redirect=auth&amp;:display_count=n&amp;:origin=viz_share_link" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dashboard</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data" id="toc-data" class="nav-link active" data-scroll-target="#data">Data</a></li>
  <li><a href="#objective" id="toc-objective" class="nav-link" data-scroll-target="#objective">Objective</a></li>
  <li><a href="#notebook-outline" id="toc-notebook-outline" class="nav-link" data-scroll-target="#notebook-outline">Notebook Outline</a></li>
  <li><a href="#section-1-imports-load-data-merge-tables" id="toc-section-1-imports-load-data-merge-tables" class="nav-link" data-scroll-target="#section-1-imports-load-data-merge-tables">Section 1: Imports, load data, merge tables</a>
  <ul class="collapse">
  <li><a href="#drop-days-when-store-is-closed-or-when-store-is-open-and-sales-0" id="toc-drop-days-when-store-is-closed-or-when-store-is-open-and-sales-0" class="nav-link" data-scroll-target="#drop-days-when-store-is-closed-or-when-store-is-open-and-sales-0">Drop days when store is closed, or when store is open and Sales == 0</a></li>
  </ul></li>
  <li><a href="#section-2-initial-cleanup" id="toc-section-2-initial-cleanup" class="nav-link" data-scroll-target="#section-2-initial-cleanup">Section 2: Initial cleanup</a>
  <ul class="collapse">
  <li><a href="#remove-customers-column" id="toc-remove-customers-column" class="nav-link" data-scroll-target="#remove-customers-column">Remove Customers column</a></li>
  <li><a href="#extract-and-transform-date-features" id="toc-extract-and-transform-date-features" class="nav-link" data-scroll-target="#extract-and-transform-date-features">Extract and transform date features</a></li>
  <li><a href="#normalize-data-types-across-columns" id="toc-normalize-data-types-across-columns" class="nav-link" data-scroll-target="#normalize-data-types-across-columns">Normalize data types across columns</a></li>
  <li><a href="#flag-anomalies-fix-them-when-possible" id="toc-flag-anomalies-fix-them-when-possible" class="nav-link" data-scroll-target="#flag-anomalies-fix-them-when-possible">Flag anomalies, fix them (when possible)</a></li>
  <li><a href="#handling-of-missing-values" id="toc-handling-of-missing-values" class="nav-link" data-scroll-target="#handling-of-missing-values">Handling of missing values</a>
  <ul class="collapse">
  <li><a href="#proportion-of-nulls" id="toc-proportion-of-nulls" class="nav-link" data-scroll-target="#proportion-of-nulls">Proportion of nulls</a></li>
  <li><a href="#missing-values-for-top-4-columns-with-the-most-nulls" id="toc-missing-values-for-top-4-columns-with-the-most-nulls" class="nav-link" data-scroll-target="#missing-values-for-top-4-columns-with-the-most-nulls">Missing values for top 4 columns with the most nulls</a></li>
  <li><a href="#null-handling-for-promo2sinceyear-promo2sinceweek-promointerval" id="toc-null-handling-for-promo2sinceyear-promo2sinceweek-promointerval" class="nav-link" data-scroll-target="#null-handling-for-promo2sinceyear-promo2sinceweek-promointerval">Null handling for Promo2SinceYear, Promo2SinceWeek, PromoInterval</a></li>
  <li><a href="#null-handling-for-competitionopensinceyear-competitionopensincemonth" id="toc-null-handling-for-competitionopensinceyear-competitionopensincemonth" class="nav-link" data-scroll-target="#null-handling-for-competitionopensinceyear-competitionopensincemonth">Null handling for CompetitionOpenSinceYear, CompetitionOpenSinceMonth</a></li>
  <li><a href="#null-handling-for-promointerval-and-competitiondistance" id="toc-null-handling-for-promointerval-and-competitiondistance" class="nav-link" data-scroll-target="#null-handling-for-promointerval-and-competitiondistance">Null Handling for PromoInterval and CompetitionDistance</a></li>
  </ul></li>
  <li><a href="#feature-encoding" id="toc-feature-encoding" class="nav-link" data-scroll-target="#feature-encoding">Feature encoding</a>
  <ul class="collapse">
  <li><a href="#feature-cardinality" id="toc-feature-cardinality" class="nav-link" data-scroll-target="#feature-cardinality">Feature cardinality</a></li>
  <li><a href="#label-encode-low-cardinality-numeric-categorical-columns" id="toc-label-encode-low-cardinality-numeric-categorical-columns" class="nav-link" data-scroll-target="#label-encode-low-cardinality-numeric-categorical-columns">Label encode low-cardinality numeric categorical columns</a></li>
  <li><a href="#label-encode-structured-categorical-features-for-tree-based-models" id="toc-label-encode-structured-categorical-features-for-tree-based-models" class="nav-link" data-scroll-target="#label-encode-structured-categorical-features-for-tree-based-models">Label-encode structured categorical features for tree-based models</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#section-3-data-exploration" id="toc-section-3-data-exploration" class="nav-link" data-scroll-target="#section-3-data-exploration">Section 3: Data exploration</a>
  <ul class="collapse">
  <li><a href="#basic-inspection" id="toc-basic-inspection" class="nav-link" data-scroll-target="#basic-inspection">Basic inspection</a></li>
  <li><a href="#data-consistency" id="toc-data-consistency" class="nav-link" data-scroll-target="#data-consistency">Data consistency</a>
  <ul class="collapse">
  <li><a href="#sales" id="toc-sales" class="nav-link" data-scroll-target="#sales">Sales</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#section-4-store-level-insights" id="toc-section-4-store-level-insights" class="nav-link" data-scroll-target="#section-4-store-level-insights">Section 4: Store-level insights</a>
  <ul class="collapse">
  <li><a href="#store-type" id="toc-store-type" class="nav-link" data-scroll-target="#store-type">Store type</a>
  <ul class="collapse">
  <li><a href="#distribution-of-store-types" id="toc-distribution-of-store-types" class="nav-link" data-scroll-target="#distribution-of-store-types">Distribution of store types</a></li>
  <li><a href="#assortment" id="toc-assortment" class="nav-link" data-scroll-target="#assortment">Assortment</a></li>
  <li><a href="#competition-distance" id="toc-competition-distance" class="nav-link" data-scroll-target="#competition-distance">Competition distance</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#section-5-promotions-and-holidays" id="toc-section-5-promotions-and-holidays" class="nav-link" data-scroll-target="#section-5-promotions-and-holidays">Section 5: Promotions and holidays</a>
  <ul class="collapse">
  <li><a href="#promo-promo2" id="toc-promo-promo2" class="nav-link" data-scroll-target="#promo-promo2">Promo / Promo2</a>
  <ul class="collapse">
  <li><a href="#distribution-of-promo-promo2-open-days-only" id="toc-distribution-of-promo-promo2-open-days-only" class="nav-link" data-scroll-target="#distribution-of-promo-promo2-open-days-only">Distribution of Promo / Promo2 (Open Days Only)</a></li>
  <li><a href="#promo-trends-over-time" id="toc-promo-trends-over-time" class="nav-link" data-scroll-target="#promo-trends-over-time">Promo trends over time</a></li>
  <li><a href="#impact-of-promos-on-sales" id="toc-impact-of-promos-on-sales" class="nav-link" data-scroll-target="#impact-of-promos-on-sales">Impact of promos on sales</a></li>
  <li><a href="#impact-of-promos-on-sales-average-sales" id="toc-impact-of-promos-on-sales-average-sales" class="nav-link" data-scroll-target="#impact-of-promos-on-sales-average-sales">Impact of promos on sales (average sales)</a></li>
  </ul></li>
  <li><a href="#holidays" id="toc-holidays" class="nav-link" data-scroll-target="#holidays">Holidays</a>
  <ul class="collapse">
  <li><a href="#impact-of-state-holidays" id="toc-impact-of-state-holidays" class="nav-link" data-scroll-target="#impact-of-state-holidays">Impact of state holidays</a></li>
  <li><a href="#statistical-test-school-holiday-vs-non-holiday-sales" id="toc-statistical-test-school-holiday-vs-non-holiday-sales" class="nav-link" data-scroll-target="#statistical-test-school-holiday-vs-non-holiday-sales">Statistical Test: School Holiday vs Non-Holiday Sales</a></li>
  <li><a href="#sales-distribution-on-school-holidays" id="toc-sales-distribution-on-school-holidays" class="nav-link" data-scroll-target="#sales-distribution-on-school-holidays">Sales distribution on school holidays</a></li>
  <li><a href="#average-sales-on-school-holidays" id="toc-average-sales-on-school-holidays" class="nav-link" data-scroll-target="#average-sales-on-school-holidays">Average sales on school holidays</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#section-6-feature-interactions" id="toc-section-6-feature-interactions" class="nav-link" data-scroll-target="#section-6-feature-interactions">Section 6: Feature interactions</a>
  <ul class="collapse">
  <li><a href="#promotional-strategy" id="toc-promotional-strategy" class="nav-link" data-scroll-target="#promotional-strategy">Promotional strategy</a>
  <ul class="collapse">
  <li><a href="#promo-storetype---sales-open-days-only" id="toc-promo-storetype---sales-open-days-only" class="nav-link" data-scroll-target="#promo-storetype---sales-open-days-only">Promo × StoreType -&gt; Sales (Open Days Only)</a></li>
  <li><a href="#promo-assortment---sales" id="toc-promo-assortment---sales" class="nav-link" data-scroll-target="#promo-assortment---sales">Promo × Assortment -&gt; Sales</a></li>
  <li><a href="#promo-dayofweek---sales" id="toc-promo-dayofweek---sales" class="nav-link" data-scroll-target="#promo-dayofweek---sales">Promo × DayOfWeek -&gt; Sales</a></li>
  <li><a href="#promo2-month---sales" id="toc-promo2-month---sales" class="nav-link" data-scroll-target="#promo2-month---sales">Promo2 × Month -&gt; Sales</a></li>
  </ul></li>
  <li><a href="#store-characteristics" id="toc-store-characteristics" class="nav-link" data-scroll-target="#store-characteristics">Store characteristics</a>
  <ul class="collapse">
  <li><a href="#storetype-x-competitiondistance---sales" id="toc-storetype-x-competitiondistance---sales" class="nav-link" data-scroll-target="#storetype-x-competitiondistance---sales">StoreType x CompetitionDistance -&gt; Sales</a></li>
  <li><a href="#storetype-x-assortment---sales" id="toc-storetype-x-assortment---sales" class="nav-link" data-scroll-target="#storetype-x-assortment---sales">StoreType x Assortment -&gt; Sales</a></li>
  <li><a href="#assortment-month---sales" id="toc-assortment-month---sales" class="nav-link" data-scroll-target="#assortment-month---sales">Assortment × Month -&gt; Sales</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#section-7-feature-engineering" id="toc-section-7-feature-engineering" class="nav-link" data-scroll-target="#section-7-feature-engineering">Section 7: Feature engineering</a>
  <ul class="collapse">
  <li><a href="#final-feature-adjustments---continuous-high-cardinality-variables" id="toc-final-feature-adjustments---continuous-high-cardinality-variables" class="nav-link" data-scroll-target="#final-feature-adjustments---continuous-high-cardinality-variables">Final feature adjustments - continuous / high-cardinality variables</a>
  <ul class="collapse">
  <li><a href="#engineer-isprestateholidaywindow-feature" id="toc-engineer-isprestateholidaywindow-feature" class="nav-link" data-scroll-target="#engineer-isprestateholidaywindow-feature">Engineer IsPreStateHolidayWindow feature</a></li>
  <li><a href="#engineer-activestorecount-feature" id="toc-engineer-activestorecount-feature" class="nav-link" data-scroll-target="#engineer-activestorecount-feature">Engineer ActiveStoreCount feature</a></li>
  <li><a href="#new-features-based-on-interactions" id="toc-new-features-based-on-interactions" class="nav-link" data-scroll-target="#new-features-based-on-interactions">New features based on interactions</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a>
  <ul class="collapse">
  <li><a href="#export-processed-dataset-for-modeling" id="toc-export-processed-dataset-for-modeling" class="nav-link" data-scroll-target="#export-processed-dataset-for-modeling">Export processed dataset for modeling</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../notebooks/01_EDA.html">Notebooks</a></li><li class="breadcrumb-item"><a href="../notebooks/01_EDA.html">EDA</a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><strong>01: Exploratory Data Analysis</strong></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<hr>
<p>This notebook explores historical sales data from Rossmann stores to uncover patterns across time, promotions, and store attributes.</p>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<ul>
<li>Rossmann is a drug store chain with over 3000 locations across Europe (kaggle.com). Each instance in this dataset contains information about a single day’s business.</li>
<li>The entire set spans approximately 3 years (2013 - 2015).</li>
<li>There are about 100,000 instances, of which roughly 84,000 contain useful information (the remaining instances are when the store was closed and sales were not possible).</li>
</ul>
</section>
<section id="objective" class="level2">
<h2 class="anchored" data-anchor-id="objective">Objective</h2>
<ul>
<li>The goals of this notebook are to understand the data deeply and begin revealing its principal trends, then preprocess it to maximize the predictive performance of the model.</li>
<li>The target of our analysis and model is <code>Sales</code>, and we are tasked with predicting daily amount for the next 6 weeks based on the given data.</li>
</ul>
</section>
<section id="notebook-outline" class="level2">
<h2 class="anchored" data-anchor-id="notebook-outline">Notebook Outline</h2>
<ol type="1">
<li><a href="#section-1-imports-load-data-merge-tables">Imports, load data, merge tables</a><br>
</li>
<li><a href="#section-2-initial-cleanup">Initial cleanup</a><br>
</li>
<li><a href="#section-3-data-exploration">Data exploration</a><br>
</li>
<li><a href="#section-4-store-level-insights">Store-level insights</a><br>
</li>
<li><a href="#section-5-promotions-and-holidays">Promotions and holidays</a><br>
</li>
<li><a href="#section-6-feature-interactions">Feature interactions</a><br>
</li>
<li><a href="#section-7-feature-engineering">Feature engineering</a><br>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ol>
</section>
<section id="section-1-imports-load-data-merge-tables" class="level1">
<h1>Section 1: Imports, load data, merge tables</h1>
<hr>
<ul>
<li><p>Load all required libraries and datasets - train.csv (main table) and store.csv (store metadata).</p></li>
<li><p>Merge on the Store column to enrich the training set with store-level features.</p></li>
</ul>
<div id="e467fb25" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Imports &amp; display settings</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> calendar</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas <span class="im">import</span> Timestamp</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> ttest_ind</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Visual / display configuration</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>sns.set_theme(style<span class="op">=</span><span class="st">"whitegrid"</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">"display.max_columns"</span>, <span class="va">None</span>)        <span class="co"># show all columns</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">"display.width"</span>, <span class="va">None</span>)              <span class="co"># auto-fit to console width</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">"display.float_format"</span>, <span class="st">"</span><span class="sc">{:,.2f}</span><span class="st">"</span>.<span class="bu">format</span>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Load datasets </span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>df_store <span class="op">=</span> pd.read_csv(<span class="st">"../data/store.csv"</span>, low_memory<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>df_train <span class="op">=</span> pd.read_csv(<span class="st">"../data/train.csv"</span>, low_memory<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co"># If your train CSV has a 'Date' column, you can parse it on read:</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co"># df_train = pd.read_csv("../data/train.csv", low_memory=False, parse_dates=["Date"])</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge store metadata into training data </span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.merge(df_train, df_store, how<span class="op">=</span><span class="st">"left"</span>, on<span class="op">=</span><span class="st">"Store"</span>)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>df_raw <span class="op">=</span> df.copy(deep<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="drop-days-when-store-is-closed-or-when-store-is-open-and-sales-0" class="level2">
<h2 class="anchored" data-anchor-id="drop-days-when-store-is-closed-or-when-store-is-open-and-sales-0">Drop days when store is closed, or when store is open and Sales == 0</h2>
<div id="032682f6" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>zero_open <span class="op">=</span> df[(df[<span class="st">"Open"</span>] <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (df[<span class="st">"Sales"</span>] <span class="op">==</span> <span class="dv">0</span>)]</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Zero-sales open days: </span><span class="sc">{</span><span class="bu">len</span>(zero_open)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[df[<span class="st">"Open"</span>] <span class="op">==</span> <span class="dv">1</span>].copy()</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(columns<span class="op">=</span>[<span class="st">"Open"</span>])</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[df[<span class="st">"Sales"</span>] <span class="op">!=</span> <span class="dv">0</span>].copy()</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>zero_open <span class="op">=</span> df[(df[<span class="st">"Sales"</span>] <span class="op">==</span> <span class="dv">0</span>)]</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Zero-sales total (regardless of open/closed): </span><span class="sc">{</span><span class="bu">len</span>(zero_open)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Zero-sales open days: 54
Zero-sales total (regardless of open/closed): 0
&lt;class 'pandas.core.frame.DataFrame'&gt;
Index: 844338 entries, 0 to 1017190
Data columns (total 17 columns):
 #   Column                     Non-Null Count   Dtype  
---  ------                     --------------   -----  
 0   Store                      844338 non-null  int64  
 1   DayOfWeek                  844338 non-null  int64  
 2   Date                       844338 non-null  object 
 3   Sales                      844338 non-null  int64  
 4   Customers                  844338 non-null  int64  
 5   Promo                      844338 non-null  int64  
 6   StateHoliday               844338 non-null  object 
 7   SchoolHoliday              844338 non-null  int64  
 8   StoreType                  844338 non-null  object 
 9   Assortment                 844338 non-null  object 
 10  CompetitionDistance        842152 non-null  float64
 11  CompetitionOpenSinceMonth  575738 non-null  float64
 12  CompetitionOpenSinceYear   575738 non-null  float64
 13  Promo2                     844338 non-null  int64  
 14  Promo2SinceWeek            421046 non-null  float64
 15  Promo2SinceYear            421046 non-null  float64
 16  PromoInterval              421046 non-null  object 
dtypes: float64(5), int64(7), object(5)
memory usage: 116.0+ MB</code></pre>
</div>
</div>
</section>
</section>
<section id="section-2-initial-cleanup" class="level1">
<h1>Section 2: Initial cleanup</h1>
<hr>
<ul>
<li>Perform essential preprocessing to make the dataset clean and consistent before exploration.</li>
<li>This includes removing unavailable target columns, extracting date components, normalizing data types, and flagging/fixing data quality issues.</li>
</ul>
<section id="remove-customers-column" class="level2">
<h2 class="anchored" data-anchor-id="remove-customers-column">Remove Customers column</h2>
<p>Drop the Customers column, which is not available at prediction time. Keeping it would cause data leakage.</p>
<div id="c93fec1a" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(columns<span class="op">=</span><span class="st">'Customers'</span>, axis<span class="op">=</span><span class="dv">1</span>).copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="extract-and-transform-date-features" class="level2">
<h2 class="anchored" data-anchor-id="extract-and-transform-date-features">Extract and transform date features</h2>
<p>Extract granular time-based features such as year, month, day, and week-related indicators from the Date column. These features may carry strong temporal signals and seasonality patterns important for modeling.</p>
<div id="b17d32cd-fc21-4794-b424-0dba5a22b05f" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert Date to datetime - normalize sets all times to 00:00:00 for readability</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Date'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'Date'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Date'</span>] <span class="op">=</span> df[<span class="st">'Date'</span>].dt.normalize()</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract features from Date for possible feature engineering</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Year'</span>] <span class="op">=</span> df[<span class="st">'Date'</span>].dt.year</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Month'</span>] <span class="op">=</span> df[<span class="st">'Date'</span>].dt.month</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Day'</span>] <span class="op">=</span> df[<span class="st">'Date'</span>].dt.day</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Seasonal and weekly patterns (ISO week number)</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Week'</span>] <span class="op">=</span> df[<span class="st">'Date'</span>].dt.isocalendar().week</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># (0 = Monday, 6 = Sunday)</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'DayOfWeek'</span>] <span class="op">=</span> df[<span class="st">'Date'</span>].dt.dayofweek </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Customer behavior likely differs depending on weekend / weekday</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'IsWeekend'</span>] <span class="op">=</span> df[<span class="st">'DayOfWeek'</span>] <span class="op">&gt;=</span> <span class="dv">5</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Make IsWeekend binary integer column</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'IsWeekend'</span>] <span class="op">=</span> df[<span class="st">'IsWeekend'</span>].astype(<span class="bu">int</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="normalize-data-types-across-columns" class="level2">
<h2 class="anchored" data-anchor-id="normalize-data-types-across-columns">Normalize data types across columns</h2>
<p>Ensure all categorical features are consistently treated as strings. This avoids encoding errors and makes feature engineering and encoding more predictable downstream.</p>
<div id="76bfaab7-3b11-4359-b6d2-00a9a7d3d959" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Consistent integer types (int64)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> df.select_dtypes(include<span class="op">=</span>[<span class="st">'int'</span>, <span class="st">'UInt32'</span>, <span class="st">'int32'</span>, <span class="st">'int16'</span>, <span class="st">'uint8'</span>]).columns:</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    df[col] <span class="op">=</span> df[col].astype(<span class="st">'int64'</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert all object-type columns to string dtype</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> convert_object_to_string(df):</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> df.select_dtypes(include<span class="op">=</span><span class="st">'object'</span>).columns:</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get the first 100 non-null values to check type consistency</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        sample_values <span class="op">=</span> df[col].dropna().head(<span class="dv">100</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If all sample values are strings (not numeric-looking), convert</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> sample_values.<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">isinstance</span>(x, <span class="bu">str</span>)).<span class="bu">all</span>():</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>            df[col] <span class="op">=</span> df[col].astype(<span class="st">'string'</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> convert_object_to_string(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="flag-anomalies-fix-them-when-possible" class="level2">
<h2 class="anchored" data-anchor-id="flag-anomalies-fix-them-when-possible">Flag anomalies, fix them (when possible)</h2>
<div id="6d4a11b8" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix metadata inconsistency: PromoInterval shouldn't exist if Promo2 == 0</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>df.loc[df[<span class="st">'Promo2'</span>] <span class="op">==</span> <span class="dv">0</span>, <span class="st">'PromoInterval'</span>] <span class="op">=</span> np.nan</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix: future-dated Promo2 start -&gt; cap to current date</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>current_year <span class="op">=</span> df[<span class="st">'Date'</span>].dt.year</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>current_week <span class="op">=</span> df[<span class="st">'Date'</span>].dt.isocalendar().week</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>df.loc[</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    (df[<span class="st">'Promo2'</span>] <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (df[<span class="st">'Promo2SinceYear'</span>] <span class="op">&gt;</span> current_year),</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Promo2SinceYear'</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>] <span class="op">=</span> current_year</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>df.loc[</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    (df[<span class="st">'Promo2'</span>] <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (df[<span class="st">'Promo2SinceYear'</span>] <span class="op">==</span> current_year) <span class="op">&amp;</span> (df[<span class="st">'Promo2SinceWeek'</span>] <span class="op">&gt;</span> current_week),</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Promo2SinceWeek'</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>] <span class="op">=</span> current_week</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co"># fix: Missing Promo2 start metadata -&gt; assume promo started at dataset start</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>min_date <span class="op">=</span> df[<span class="st">'Date'</span>].<span class="bu">min</span>()</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>df.loc[</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    (df[<span class="st">'Promo2'</span>] <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (df[<span class="st">'Promo2SinceYear'</span>].isna()),</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Promo2SinceYear'</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>] <span class="op">=</span> min_date.year</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>df.loc[</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    (df[<span class="st">'Promo2'</span>] <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (df[<span class="st">'Promo2SinceWeek'</span>].isna()),</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Promo2SinceWeek'</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>] <span class="op">=</span> min_date.isocalendar().week</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="handling-of-missing-values" class="level2">
<h2 class="anchored" data-anchor-id="handling-of-missing-values">Handling of missing values</h2>
<p>Quantify the percentage of missing values for each column to inform which fields require imputation, special handling, or potential exclusion.</p>
<section id="proportion-of-nulls" class="level3">
<h3 class="anchored" data-anchor-id="proportion-of-nulls">Proportion of nulls</h3>
<div id="2958de87" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df.isnull().mean().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>Promo2SinceYear             0.50
PromoInterval               0.50
Promo2SinceWeek             0.50
CompetitionOpenSinceYear    0.32
CompetitionOpenSinceMonth   0.32
CompetitionDistance         0.00
Promo                       0.00
Date                        0.00
DayOfWeek                   0.00
Store                       0.00
Sales                       0.00
Assortment                  0.00
StateHoliday                0.00
Promo2                      0.00
SchoolHoliday               0.00
StoreType                   0.00
Year                        0.00
Month                       0.00
Day                         0.00
Week                        0.00
IsWeekend                   0.00
dtype: float64</code></pre>
</div>
</div>
</section>
<section id="missing-values-for-top-4-columns-with-the-most-nulls" class="level3">
<h3 class="anchored" data-anchor-id="missing-values-for-top-4-columns-with-the-most-nulls">Missing values for top 4 columns with the most nulls</h3>
<p>Visualize the absolute count of missing values in the columns with the highest proportion of nulls. This provides a quick overview of which fields require targeted cleanup.</p>
<div id="863d1ab2" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-scrolled="true" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Target columns</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>cols_to_check <span class="op">=</span> [<span class="st">'Promo2SinceYear'</span>, <span class="st">'PromoInterval'</span>, <span class="st">'Promo2SinceWeek'</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                 <span class="st">'CompetitionOpenSinceYear'</span>, <span class="st">'CompetitionOpenSinceMonth'</span>]</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Count missing values</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>missing_counts <span class="op">=</span> df[cols_to_check].isnull().<span class="bu">sum</span>()</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>missing_df <span class="op">=</span> missing_counts[missing_counts <span class="op">&gt;</span> <span class="dv">0</span>].sort_values(ascending<span class="op">=</span><span class="va">False</span>).reset_index()</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>missing_df.columns <span class="op">=</span> [<span class="st">'Column'</span>, <span class="st">'MissingValues'</span>]</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span><span class="st">'Column'</span>, y<span class="op">=</span><span class="st">'MissingValues'</span>, data<span class="op">=</span>missing_df, palette<span class="op">=</span><span class="st">'muted'</span>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Missing Values per Column'</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Count of Missing Values'</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Column'</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-9-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="null-handling-for-promo2sinceyear-promo2sinceweek-promointerval" class="level3">
<h3 class="anchored" data-anchor-id="null-handling-for-promo2sinceyear-promo2sinceweek-promointerval">Null handling for Promo2SinceYear, Promo2SinceWeek, PromoInterval</h3>
<ul>
<li><p>For stores with Promo2 == 1, we impute safe defaults in Promo2SinceYear and Promo2SinceWeek to allow type conversion.</p></li>
<li><p>Then we compute Promo2Start as a date, calculate promo duration in weeks, and set duration to 0 for inactive stores.</p></li>
</ul>
<div id="336c5208" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Only run for rows where Promo2 == 1</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>promo2_rows <span class="op">=</span> df[<span class="st">'Promo2'</span>] <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to integers safely</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>df.loc[promo2_rows, <span class="st">'Promo2SinceYear'</span>] <span class="op">=</span> df.loc[promo2_rows, <span class="st">'Promo2SinceYear'</span>].fillna(<span class="dv">0</span>).astype(<span class="bu">int</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>df.loc[promo2_rows, <span class="st">'Promo2SinceWeek'</span>] <span class="op">=</span> df.loc[promo2_rows, <span class="st">'Promo2SinceWeek'</span>].fillna(<span class="dv">1</span>).astype(<span class="bu">int</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert Promo2SinceWeek to a start-of-week date</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Updated function using ISO week logic</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> week_to_date(year, week):</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.to_datetime(<span class="ss">f'</span><span class="sc">{</span><span class="bu">int</span>(year)<span class="sc">}</span><span class="ss">-</span><span class="sc">{</span><span class="bu">int</span>(week)<span class="sc">}</span><span class="ss">-1'</span>, <span class="bu">format</span><span class="op">=</span><span class="st">'</span><span class="sc">%G</span><span class="st">-%V-</span><span class="sc">%u</span><span class="st">'</span>)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.NaT</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Promo2Start'</span>] <span class="op">=</span> df.<span class="bu">apply</span>(</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> row: week_to_date(row[<span class="st">'Promo2SinceYear'</span>], row[<span class="st">'Promo2SinceWeek'</span>]) <span class="cf">if</span> row[<span class="st">'Promo2'</span>] <span class="op">==</span> <span class="dv">1</span> <span class="cf">else</span> pd.NaT,</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    axis<span class="op">=</span><span class="dv">1</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate duration in weeks (or days)</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Promo2DurationWeeks'</span>] <span class="op">=</span> (df[<span class="st">'Date'</span>] <span class="op">-</span> df[<span class="st">'Promo2Start'</span>]).dt.days <span class="op">//</span> <span class="dv">7</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="co"># fill NaN durations with 0 where Promo2 is inactive</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Promo2DurationWeeks'</span>] <span class="op">=</span> df[<span class="st">'Promo2DurationWeeks'</span>].where(df[<span class="st">'Promo2'</span>] <span class="op">==</span> <span class="dv">1</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="ef9ab22e" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="10">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Promo2Start'</span>].info()</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Promo2Start'</span>].head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.series.Series'&gt;
Index: 844338 entries, 0 to 1017190
Series name: Promo2Start
Non-Null Count   Dtype         
--------------   -----         
421046 non-null  datetime64[ns]
dtypes: datetime64[ns](1)
memory usage: 45.1 MB</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>0          NaT
1   2010-03-29
2   2011-04-04
3          NaT
4          NaT
5          NaT
6          NaT
7          NaT
8          NaT
9          NaT
Name: Promo2Start, dtype: datetime64[ns]</code></pre>
</div>
</div>
</section>
<section id="null-handling-for-competitionopensinceyear-competitionopensincemonth" class="level3">
<h3 class="anchored" data-anchor-id="null-handling-for-competitionopensinceyear-competitionopensincemonth">Null handling for CompetitionOpenSinceYear, CompetitionOpenSinceMonth</h3>
<p>Handle missing values in competition-related fields. If either component of the open date is missing, we impute the missing part with the median or a fallback and reconstruct the full competition open date.</p>
<div id="66bc31e0" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;outputs_hidden&quot;:true,&quot;source_hidden&quot;:true}}" data-execution_count="11">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Encode low-cardinality integer columns (safe handling of NaNs)</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>label_cols <span class="op">=</span> [<span class="st">'DayOfWeek'</span>, <span class="st">'Promo2SinceYear'</span>]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> label_cols:</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    df[col] <span class="op">=</span> df[col].fillna(<span class="op">-</span><span class="dv">1</span>).astype(<span class="st">'int64'</span>)  <span class="co"># -1 = missing</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create datetime column 'CompetitionOpenSince'</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'CompetitionOpenSince'</span>] <span class="op">=</span> pd.to_datetime(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">dict</span>(</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>        year<span class="op">=</span>df[<span class="st">'CompetitionOpenSinceYear'</span>],</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>        month<span class="op">=</span>df[<span class="st">'CompetitionOpenSinceMonth'</span>],</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>        day<span class="op">=</span><span class="dv">1</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    errors<span class="op">=</span><span class="st">'coerce'</span>  <span class="co"># Convert invalid entries to NaT</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Find earliest date in the dataset per store</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>store_start <span class="op">=</span> df.groupby(<span class="st">'Store'</span>)[<span class="st">'Date'</span>].<span class="bu">min</span>().rename(<span class="st">'StoreStartDate'</span>).reset_index()</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge that back into main df</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.merge(store_start, on<span class="op">=</span><span class="st">'Store'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill missing CompetitionOpenSince with StoreStartDate</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'CompetitionOpenSince'</span>] <span class="op">=</span> df[<span class="st">'CompetitionOpenSince'</span>].fillna(df[<span class="st">'StoreStartDate'</span>])</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute duration in months</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'CompetitionOpenDuration'</span>] <span class="op">=</span> (</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    (df[<span class="st">'Date'</span>] <span class="op">-</span> df[<span class="st">'CompetitionOpenSince'</span>]).dt.days <span class="op">//</span> <span class="dv">30</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 844338 entries, 0 to 844337
Data columns (total 26 columns):
 #   Column                     Non-Null Count   Dtype         
---  ------                     --------------   -----         
 0   Store                      844338 non-null  int64         
 1   DayOfWeek                  844338 non-null  int64         
 2   Date                       844338 non-null  datetime64[ns]
 3   Sales                      844338 non-null  int64         
 4   Promo                      844338 non-null  int64         
 5   StateHoliday               844338 non-null  string        
 6   SchoolHoliday              844338 non-null  int64         
 7   StoreType                  844338 non-null  string        
 8   Assortment                 844338 non-null  string        
 9   CompetitionDistance        842152 non-null  float64       
 10  CompetitionOpenSinceMonth  575738 non-null  float64       
 11  CompetitionOpenSinceYear   575738 non-null  float64       
 12  Promo2                     844338 non-null  int64         
 13  Promo2SinceWeek            421046 non-null  float64       
 14  Promo2SinceYear            844338 non-null  int64         
 15  PromoInterval              421046 non-null  string        
 16  Year                       844338 non-null  int64         
 17  Month                      844338 non-null  int64         
 18  Day                        844338 non-null  int64         
 19  Week                       844338 non-null  int64         
 20  IsWeekend                  844338 non-null  int64         
 21  Promo2Start                421046 non-null  datetime64[ns]
 22  Promo2DurationWeeks        844338 non-null  float64       
 23  CompetitionOpenSince       844338 non-null  datetime64[ns]
 24  StoreStartDate             844338 non-null  datetime64[ns]
 25  CompetitionOpenDuration    844338 non-null  int64         
dtypes: datetime64[ns](4), float64(5), int64(13), string(4)
memory usage: 167.5 MB</code></pre>
</div>
</div>
</section>
<section id="null-handling-for-promointerval-and-competitiondistance" class="level3">
<h3 class="anchored" data-anchor-id="null-handling-for-promointerval-and-competitiondistance">Null Handling for PromoInterval and CompetitionDistance</h3>
<ul>
<li><p>We drop <code>PromoInterval</code> because its meaning is redundant with existing <code>Promo2</code>, <code>Promo2SinceWeek</code>, and <code>Promo2SinceYear</code> fields. Most of its values are missing for non-participating stores (where Promo2 == 0), and the remaining information is already captured in the constructed <code>Promo2Start</code> and <code>Promo2DurationWeeks</code>.</p></li>
<li><p>For <code>CompetitionDistance</code>, we impute missing values using the median. This avoids introducing outliers or bias into the model, since the missing values are rare (~0.2% of rows) and unlikely to carry a specific signal. Imputing with the median preserves distributional stability and avoids skewing model behavior.</p></li>
</ul>
<div id="e028b55a" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="12">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop 'PromoInterval' — redundant with Promo2 logic</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>df.drop(columns<span class="op">=</span>[<span class="st">'PromoInterval'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Impute missing CompetitionDistance with median value</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>median_distance <span class="op">=</span> df[<span class="st">'CompetitionDistance'</span>].median()</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'CompetitionDistance'</span>] <span class="op">=</span> df[<span class="st">'CompetitionDistance'</span>].fillna(median_distance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="feature-encoding" class="level2">
<h2 class="anchored" data-anchor-id="feature-encoding">Feature encoding</h2>
<p>Prepare for encoding by inspecting feature cardinality. This step informs the choice between one-hot encoding, label encoding, or grouping of rare categories.</p>
<section id="feature-cardinality" class="level3">
<h3 class="anchored" data-anchor-id="feature-cardinality">Feature cardinality</h3>
<p>Display the number of unique values for each feature. Features with low cardinality are good candidates for one-hot encoding, while high-cardinality features may require alternative strategies.</p>
<div id="162dafde" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="13">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df.nunique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>Store                         1115
DayOfWeek                        7
Date                           942
Sales                        21733
Promo                            2
StateHoliday                     4
SchoolHoliday                    2
StoreType                        4
Assortment                       3
CompetitionDistance            654
CompetitionOpenSinceMonth       12
CompetitionOpenSinceYear        23
Promo2                           2
Promo2SinceWeek                 50
Promo2SinceYear                  8
Year                             3
Month                           12
Day                             31
Week                            52
IsWeekend                        2
Promo2Start                    150
Promo2DurationWeeks            314
CompetitionOpenSince           174
StoreStartDate                   5
CompetitionOpenDuration        376
dtype: int64</code></pre>
</div>
</div>
</section>
<section id="label-encode-low-cardinality-numeric-categorical-columns" class="level3">
<h3 class="anchored" data-anchor-id="label-encode-low-cardinality-numeric-categorical-columns">Label encode low-cardinality numeric categorical columns</h3>
<ul>
<li><p>We encode numeric categorical features with a small number of discrete values ( DayOfWeek, Promo2SinceYear) by casting them to int64.</p></li>
<li><p>Missing values are filled with -1 to preserve numerical format while signaling “missing” in a way that models can interpret.</p></li>
<li><p>This avoids issues with NaNs during modeling while preserving ordinal or numeric meaning where applicable.</p></li>
</ul>
<div id="a11ccf29-b310-44e4-a231-93c73f8bd76c" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="14">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Label encode simple binary or low-card columns (already 0/1 or small integers)</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>label_cols <span class="op">=</span> [</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'DayOfWeek'</span>,         <span class="co"># 1–7</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Promo2SinceYear'</span>    <span class="co"># up to 8 unique values</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> label_cols:</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fill NaNs with -1 to safely cast to int</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    df[col] <span class="op">=</span> df[col].fillna(<span class="op">-</span><span class="dv">1</span>).astype(<span class="st">'int64'</span>)  <span class="co"># -1 means "missing"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="77b18c57" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="15">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>zero_open <span class="op">=</span> df[(df[<span class="st">"Sales"</span>] <span class="op">==</span> <span class="dv">0</span>)]</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Zero-sales total (regardless of open/closed): </span><span class="sc">{</span><span class="bu">len</span>(zero_open)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Zero-sales total (regardless of open/closed): 0</code></pre>
</div>
</div>
<blockquote class="blockquote">
<h3 id="encode-isstateholiday-column-to-binary" class="anchored">Encode IsStateHoliday column to binary</h3>
<ul>
<li>Convert the StateHoliday column into a binary format, mapping ‘0’ to 0 (not a holiday) and other holiday types (‘a’, ‘b’, ‘c’) to 1. This simplifies sparse holiday categories into a single binary feature to capture their overall impact on sales.</li>
</ul>
</blockquote>
<ul>
<li>Rename SchoolHoliday to IsSchoolHoliday for naming consistency.</li>
</ul>
<div id="e43c10b3" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="16">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out non-holidays</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>holiday_df <span class="op">=</span> df[df[<span class="st">'StateHoliday'</span>] <span class="op">!=</span> <span class="st">'0'</span>]</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>sns.countplot(x<span class="op">=</span><span class="st">'StateHoliday'</span>, data<span class="op">=</span>holiday_df, palette<span class="op">=</span><span class="st">'pastel'</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Distribution of State Holidays (StateHoliday ≠ '0')"</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Holiday Type"</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Count"</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-17-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="eb7911b8" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="17">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Encode StateHoliday as binary IsStateHoliday column</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'IsStateHoliday'</span>] <span class="op">=</span> df[<span class="st">'StateHoliday'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="dv">0</span> <span class="cf">if</span> x <span class="op">==</span> <span class="st">'0'</span> <span class="cf">else</span> <span class="dv">1</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename SchoolHoliday -&gt; IsSchoolHoliday for consistency</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>df.rename(columns<span class="op">=</span>{<span class="st">'SchoolHoliday'</span>: <span class="st">'IsSchoolHoliday'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="94c73242" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="18">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot distribution of binary StateHoliday values</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>sns.countplot(x<span class="op">=</span><span class="st">'IsStateHoliday'</span>, data<span class="op">=</span>df, palette<span class="op">=</span><span class="st">'pastel'</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Distribution of Binary State Holidays (0 = No, 1 = Holiday)"</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Is State Holiday"</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Count"</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>plt.xticks([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="st">'No (0)'</span>, <span class="st">'Yes (1)'</span>])  </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-19-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="label-encode-structured-categorical-features-for-tree-based-models" class="level3">
<h3 class="anchored" data-anchor-id="label-encode-structured-categorical-features-for-tree-based-models">Label-encode structured categorical features for tree-based models</h3>
<p>Convert features like weeks, months, and opening dates into numeric format using LabelEncoder.</p>
<p>While some of these columns have an inherent order (Month, Week), we apply label encoding for simplicity and compatibility with tree-based models (XGBoost).</p>
<p>Inputs are cast to string to ensure consistent encoding, even for integer-based columns with missing or irregular values.</p>
<div id="f13044c6-7060-4ec7-8ca0-db152c496ef6" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="19">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Columns to label encode</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>ordinal_cols <span class="op">=</span> [</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Promo2SinceWeek'</span>, </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CompetitionOpenSinceMonth'</span>, </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CompetitionOpenSinceYear'</span>, </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Week'</span>, </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Day'</span>, </span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply Label Encoding - cast to string for consistent encoding </span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>le <span class="op">=</span> LabelEncoder()</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> ordinal_cols:</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    df[col] <span class="op">=</span> le.fit_transform(df[col].astype(<span class="bu">str</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
</section>
<section id="section-3-data-exploration" class="level1">
<h1>Section 3: Data exploration</h1>
<hr>
<ul>
<li>Perform exploratory analysis to understand data structure, identify potential issues, and begin recognizing key trends.</li>
<li>This includes inspecting data types, missing values, date ranges, sales distribution, and temporal patterns.</li>
</ul>
<section id="basic-inspection" class="level2">
<h2 class="anchored" data-anchor-id="basic-inspection">Basic inspection</h2>
<p>Confirm latest format of updated dataframe.</p>
<div id="9711add0-ab5e-4484-b5b6-bfb4b11146d0" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="20">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 844338 entries, 0 to 844337
Data columns (total 26 columns):
 #   Column                     Non-Null Count   Dtype         
---  ------                     --------------   -----         
 0   Store                      844338 non-null  int64         
 1   DayOfWeek                  844338 non-null  int64         
 2   Date                       844338 non-null  datetime64[ns]
 3   Sales                      844338 non-null  int64         
 4   Promo                      844338 non-null  int64         
 5   StateHoliday               844338 non-null  string        
 6   IsSchoolHoliday            844338 non-null  int64         
 7   StoreType                  844338 non-null  string        
 8   Assortment                 844338 non-null  string        
 9   CompetitionDistance        844338 non-null  float64       
 10  CompetitionOpenSinceMonth  844338 non-null  int64         
 11  CompetitionOpenSinceYear   844338 non-null  int64         
 12  Promo2                     844338 non-null  int64         
 13  Promo2SinceWeek            844338 non-null  int64         
 14  Promo2SinceYear            844338 non-null  int64         
 15  Year                       844338 non-null  int64         
 16  Month                      844338 non-null  int64         
 17  Day                        844338 non-null  int64         
 18  Week                       844338 non-null  int64         
 19  IsWeekend                  844338 non-null  int64         
 20  Promo2Start                421046 non-null  datetime64[ns]
 21  Promo2DurationWeeks        844338 non-null  float64       
 22  CompetitionOpenSince       844338 non-null  datetime64[ns]
 23  StoreStartDate             844338 non-null  datetime64[ns]
 24  CompetitionOpenDuration    844338 non-null  int64         
 25  IsStateHoliday             844338 non-null  int64         
dtypes: datetime64[ns](4), float64(2), int64(17), string(3)
memory usage: 167.5 MB</code></pre>
</div>
</div>
<div id="28f2c400" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-scrolled="true" data-execution_count="21">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>df.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Store</th>
<th data-quarto-table-cell-role="th">DayOfWeek</th>
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">Sales</th>
<th data-quarto-table-cell-role="th">Promo</th>
<th data-quarto-table-cell-role="th">IsSchoolHoliday</th>
<th data-quarto-table-cell-role="th">CompetitionDistance</th>
<th data-quarto-table-cell-role="th">CompetitionOpenSinceMonth</th>
<th data-quarto-table-cell-role="th">CompetitionOpenSinceYear</th>
<th data-quarto-table-cell-role="th">Promo2</th>
<th data-quarto-table-cell-role="th">Promo2SinceWeek</th>
<th data-quarto-table-cell-role="th">Promo2SinceYear</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Month</th>
<th data-quarto-table-cell-role="th">Day</th>
<th data-quarto-table-cell-role="th">Week</th>
<th data-quarto-table-cell-role="th">IsWeekend</th>
<th data-quarto-table-cell-role="th">Promo2Start</th>
<th data-quarto-table-cell-role="th">Promo2DurationWeeks</th>
<th data-quarto-table-cell-role="th">CompetitionOpenSince</th>
<th data-quarto-table-cell-role="th">StoreStartDate</th>
<th data-quarto-table-cell-role="th">CompetitionOpenDuration</th>
<th data-quarto-table-cell-role="th">IsStateHoliday</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>844,338.00</td>
<td>844,338.00</td>
<td>844338</td>
<td>844,338.00</td>
<td>844,338.00</td>
<td>844,338.00</td>
<td>844,338.00</td>
<td>844,338.00</td>
<td>844,338.00</td>
<td>844,338.00</td>
<td>844,338.00</td>
<td>844,338.00</td>
<td>844,338.00</td>
<td>844,338.00</td>
<td>844,338.00</td>
<td>844,338.00</td>
<td>844,338.00</td>
<td>421046</td>
<td>844,338.00</td>
<td>844338</td>
<td>844338</td>
<td>844,338.00</td>
<td>844,338.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>558.42</td>
<td>2.52</td>
<td>2014-04-11 01:08:38.729702912</td>
<td>6,955.96</td>
<td>0.45</td>
<td>0.19</td>
<td>5,450.03</td>
<td>7.93</td>
<td>18.15</td>
<td>0.50</td>
<td>35.10</td>
<td>1,002.66</td>
<td>2,013.83</td>
<td>5.85</td>
<td>14.89</td>
<td>23.89</td>
<td>0.17</td>
<td>2012-01-23 17:13:56.220270336</td>
<td>57.10</td>
<td>2010-06-03 06:34:41.007369216</td>
<td>2013-01-02 09:10:15.020999424</td>
<td>46.44</td>
<td>0.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">min</td>
<td>1.00</td>
<td>0.00</td>
<td>2013-01-01 00:00:00</td>
<td>46.00</td>
<td>0.00</td>
<td>0.00</td>
<td>20.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>-1.00</td>
<td>2,013.00</td>
<td>1.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>2009-07-27 00:00:00</td>
<td>0.00</td>
<td>1900-01-01 00:00:00</td>
<td>2013-01-01 00:00:00</td>
<td>-32.00</td>
<td>0.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25%</td>
<td>280.00</td>
<td>1.00</td>
<td>2013-08-16 00:00:00</td>
<td>4,859.00</td>
<td>0.00</td>
<td>0.00</td>
<td>710.00</td>
<td>5.00</td>
<td>15.00</td>
<td>0.00</td>
<td>19.00</td>
<td>-1.00</td>
<td>2,013.00</td>
<td>3.00</td>
<td>7.00</td>
<td>11.00</td>
<td>0.00</td>
<td>2011-02-28 00:00:00</td>
<td>0.00</td>
<td>2008-03-01 00:00:00</td>
<td>2013-01-02 00:00:00</td>
<td>10.00</td>
<td>0.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">50%</td>
<td>558.00</td>
<td>2.00</td>
<td>2014-03-31 00:00:00</td>
<td>6,369.00</td>
<td>0.00</td>
<td>0.00</td>
<td>2,320.00</td>
<td>9.00</td>
<td>19.00</td>
<td>0.00</td>
<td>50.00</td>
<td>-1.00</td>
<td>2,014.00</td>
<td>6.00</td>
<td>15.00</td>
<td>22.00</td>
<td>0.00</td>
<td>2012-04-02 00:00:00</td>
<td>0.00</td>
<td>2012-11-01 00:00:00</td>
<td>2013-01-02 00:00:00</td>
<td>26.00</td>
<td>0.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">75%</td>
<td>837.00</td>
<td>4.00</td>
<td>2014-12-11 00:00:00</td>
<td>8,360.00</td>
<td>1.00</td>
<td>0.00</td>
<td>6,880.00</td>
<td>12.00</td>
<td>23.00</td>
<td>1.00</td>
<td>50.00</td>
<td>2,012.00</td>
<td>2,014.00</td>
<td>8.00</td>
<td>22.00</td>
<td>37.00</td>
<td>0.00</td>
<td>2013-03-04 00:00:00</td>
<td>108.00</td>
<td>2013-01-02 00:00:00</td>
<td>2013-01-02 00:00:00</td>
<td>74.00</td>
<td>0.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">max</td>
<td>1,115.00</td>
<td>6.00</td>
<td>2015-07-31 00:00:00</td>
<td>41,551.00</td>
<td>1.00</td>
<td>1.00</td>
<td>75,860.00</td>
<td>12.00</td>
<td>23.00</td>
<td>1.00</td>
<td>50.00</td>
<td>2,015.00</td>
<td>2,015.00</td>
<td>12.00</td>
<td>30.00</td>
<td>51.00</td>
<td>1.00</td>
<td>2015-06-01 00:00:00</td>
<td>313.00</td>
<td>2015-08-01 00:00:00</td>
<td>2013-07-05 00:00:00</td>
<td>1,407.00</td>
<td>1.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">std</td>
<td>321.73</td>
<td>1.72</td>
<td>NaN</td>
<td>3,103.82</td>
<td>0.50</td>
<td>0.40</td>
<td>7,801.09</td>
<td>3.96</td>
<td>4.90</td>
<td>0.50</td>
<td>18.63</td>
<td>1,006.33</td>
<td>0.78</td>
<td>3.32</td>
<td>8.89</td>
<td>15.33</td>
<td>0.38</td>
<td>NaN</td>
<td>82.31</td>
<td>NaN</td>
<td>NaN</td>
<td>64.36</td>
<td>0.03</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="data-consistency" class="level2">
<h2 class="anchored" data-anchor-id="data-consistency">Data consistency</h2>
<ul>
<li>We observe a dip in the number of daily records during part of the time series—likely due to store closures or incomplete reporting.</li>
<li>This will be addressed in a later section by accounting for the number of active stores per day to ensure fair normalization of sales figures across time.</li>
</ul>
<div id="89fc89ff" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="22">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Start date:"</span>, df[<span class="st">'Date'</span>].<span class="bu">min</span>())</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"End date:"</span>, df[<span class="st">'Date'</span>].<span class="bu">max</span>())</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Date range:"</span>, (df[<span class="st">'Date'</span>].<span class="bu">max</span>() <span class="op">-</span> df[<span class="st">'Date'</span>].<span class="bu">min</span>()))</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Date'</span>].value_counts().sort_index().plot()</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Date'</span>].value_counts().sort_index().plot(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span>))</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Number of Records Per Day"</span>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Date"</span>)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Record Count"</span>)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="dv">0</span>)  </span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Start date: 2013-01-01 00:00:00
End date: 2015-07-31 00:00:00
Date range: 941 days 00:00:00</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-23-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="sales" class="level3">
<h3 class="anchored" data-anchor-id="sales">Sales</h3>
<ul>
<li>Plot the average sales per store to examine cross-store variability. This reveals how store performance is distributed and whether some stores consistently underperform or dominate sales volume.</li>
</ul>
<section id="sales-distribution" class="level4">
<h4 class="anchored" data-anchor-id="sales-distribution">Sales distribution</h4>
<ul>
<li><p>Visualize the average sales per store and the raw daily sales.</p></li>
<li><p>The histograms shows strong right skew, confirming that many stores make low sales and only a few achieve very high values. This informs potential transformations.</p></li>
</ul>
<div id="316b907b" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="23">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Average sales (in currency units) for all stores </span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">'Store'</span>)[<span class="st">'Sales'</span>].mean().hist()</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Avg Sales Per Store"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>Text(0.5, 1.0, 'Avg Sales Per Store')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-24-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="393c5052" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="24">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Actual sales numbers</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>sns.histplot(df[<span class="st">'Sales'</span>], bins<span class="op">=</span><span class="dv">100</span>, kde<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Sales Distribution"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>Text(0.5, 1.0, 'Sales Distribution')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-25-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="average-overall-sales-by-date" class="level4">
<h4 class="anchored" data-anchor-id="average-overall-sales-by-date">Average overall sales by date</h4>
<ul>
<li><p>Plot the daily average sales across all stores, applying LOWESS smoothing to reveal seasonality and temporal trends. This helps identify sales peaks (holidays or promotions) and long-term cycles that may influence forecasting.</p></li>
<li><p>The LOWESS-smoothed line reveals several recurring peaks in average daily sales, suggesting strong seasonality effects. These spikes likely align with major holidays or promotional events.</p></li>
<li><p>We also observe a generally stable sales level between peaks, indicating that most stores maintain consistent performance outside of promotional periods.</p></li>
</ul>
<div id="5c527a83" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="25">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group sales by date </span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>daily_avg <span class="op">=</span> df.groupby(<span class="st">'Date'</span>)[<span class="st">'Sales'</span>].mean().reset_index()</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply LOWESS smoothing</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>lowess <span class="op">=</span> sm.nonparametric.lowess</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>smoothed <span class="op">=</span> lowess(daily_avg[<span class="st">'Sales'</span>], daily_avg[<span class="st">'Date'</span>], frac<span class="op">=</span><span class="fl">0.05</span>)  <span class="co"># frac adjusts smoothness</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>daily_avg, x<span class="op">=</span><span class="st">'Date'</span>, y<span class="op">=</span><span class="st">'Sales'</span>, color<span class="op">=</span><span class="st">'lightblue'</span>, label<span class="op">=</span><span class="st">'Daily Avg Sales'</span>)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>plt.plot(daily_avg[<span class="st">'Date'</span>], smoothed[:, <span class="dv">1</span>], color<span class="op">=</span><span class="st">'darkblue'</span>, label<span class="op">=</span><span class="st">'LOWESS Smoothed'</span>)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Average Daily Sales "</span>)</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Date'</span>)</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Average Sales'</span>)</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-26-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="section-4-store-level-insights" class="level1">
<h1>Section 4: Store-level insights</h1>
<hr>
<ul>
<li>Average sales by store</li>
<li>Sales over time for a few example stores</li>
<li>Store type distribution</li>
<li>Competition distance distribution</li>
</ul>
<section id="store-type" class="level2">
<h2 class="anchored" data-anchor-id="store-type">Store type</h2>
<section id="distribution-of-store-types" class="level3">
<h3 class="anchored" data-anchor-id="distribution-of-store-types">Distribution of store types</h3>
<ul>
<li><p>Store type ‘a’ dominates the dataset, accounting for the majority of entries. Store types ‘c’ and ‘d’ appear significantly less frequently, while ‘b’ is rare.</p>
<ul>
<li>This class imbalance should be kept in mind for modeling and interpretation, especially if store type is used as a feature — models may overweight patterns found in the dominant type. It may also be helpful to explore whether store performance varies significantly by type.</li>
</ul></li>
</ul>
<div id="e85b59aa" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="26">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>sns.countplot(x<span class="op">=</span>df[<span class="st">'StoreType'</span>], data<span class="op">=</span>df, palette<span class="op">=</span><span class="st">"Set2"</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution of StoreType'</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(col)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Count"</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-27-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="top-20-performing-stores-by-average-sales" class="level4">
<h4 class="anchored" data-anchor-id="top-20-performing-stores-by-average-sales">Top 20 performing stores by average sales</h4>
<ul>
<li><p>This bar chart highlights the top 20 stores with the highest average daily sales.</p>
<ul>
<li><p>Store 817 stands out as a clear leader, significantly outperforming all others.</p></li>
<li><p>Most other top-performing stores cluster between 12,000 and 18,000 in average sales, suggesting a small subset of stores drive a disproportionate share of overall revenue.</p></li>
<li><p>This distribution may indicate regional effects, store format advantages, or localized customer behavior — all of which warrant further investigation.</p></li>
</ul></li>
</ul>
<div id="7f6912f6" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="27">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>top_n <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>avg_sales_by_store <span class="op">=</span> df.groupby(<span class="st">'Store'</span>)[<span class="st">'Sales'</span>].mean().sort_values(ascending<span class="op">=</span><span class="va">False</span>).head(top_n).reset_index()</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>sns.barplot(data<span class="op">=</span>avg_sales_by_store, x<span class="op">=</span><span class="st">'Store'</span>, y<span class="op">=</span><span class="st">'Sales'</span>, palette<span class="op">=</span><span class="st">'Blues_d'</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Top </span><span class="sc">{</span>top_n<span class="sc">}</span><span class="ss"> Stores by Average Sales'</span>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Store ID'</span>)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Average Sales'</span>)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-28-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="sales-of-each-type-of-store" class="level4">
<h4 class="anchored" data-anchor-id="sales-of-each-type-of-store">Sales of each type of store</h4>
<ul>
<li><p>The first boxplot shows the full distribution of daily sales for each store type, highlighting outliers and spread.</p>
<ul>
<li>Store type b clearly exhibits the highest median and widest variability in sales, while types a, c, and d show similar, more modest distributions.</li>
</ul></li>
<li><p>The second chart summarizes these results using mean sales and standard deviation.</p>
<ul>
<li>Again, store type b leads in average performance, with a substantially higher mean and wider standard deviation, indicating more volatile but potentially more profitable behavior.</li>
</ul></li>
</ul>
<div id="ad2237e1" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="28">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>sns.boxplot(x<span class="op">=</span><span class="st">'StoreType'</span>, y<span class="op">=</span><span class="st">'Sales'</span>, data<span class="op">=</span>df, palette<span class="op">=</span><span class="st">'Set2'</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Sales Distribution by Store Type'</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Store Type'</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Sales'</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-29-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="bb5bd43f" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="29">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span><span class="st">'StoreType'</span>, y<span class="op">=</span><span class="st">'Sales'</span>, data<span class="op">=</span>df, estimator<span class="op">=</span><span class="st">'mean'</span>, ci<span class="op">=</span><span class="st">'sd'</span>, palette<span class="op">=</span><span class="st">'Set2'</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Average Sales by Store Type'</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Store Type'</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Mean Sales ± SD'</span>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-30-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="count-of-each-type-of-store" class="level4">
<h4 class="anchored" data-anchor-id="count-of-each-type-of-store">Count of each type of store</h4>
<ul>
<li><p>This plot shows the distribution of store types in the dataset. Store type a is by far the most common, followed by d, c, and a small number of type b stores.</p></li>
<li><p>When viewed in context with the earlier sales plots:</p>
<ul>
<li><p>Type b stores are rare but exhibit the highest average sales and largest spread, suggesting they are high-performing, high-variance locations.</p></li>
<li><p>Type a stores dominate in count but have moderate average sales. Types c and d have similar mid-range sales performance.</p></li>
</ul></li>
</ul>
<div id="7e745106" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="30">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>sns.countplot(x<span class="op">=</span><span class="st">'StoreType'</span>, data<span class="op">=</span>df, palette<span class="op">=</span><span class="st">'Set2'</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution of StoreType'</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'StoreType'</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Count'</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-31-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="assortment" class="level3">
<h3 class="anchored" data-anchor-id="assortment">Assortment</h3>
<ul>
<li><p>The majority of stores fall under assortment types ‘a’ and ‘c’, with type ‘b’ being extremely rare.</p>
<ul>
<li><p>Despite its low representation, assortment type ‘b’ has the highest average sales and a visibly higher sales distribution.</p></li>
<li><p>This suggests that type ‘b’ assortments may be strategically used in high-performing locations or target specific customer segments that yield higher revenue.</p></li>
</ul></li>
<li><p>Assortments ‘a’ and ‘c’ have similar average sales and distributions, but given their large volume, they may represent standard offerings.</p>
<ul>
<li>The wide standard deviations across all types indicate considerable variability in store performance within each assortment category, especially in type ‘b’, which shows both high mean and high variance.</li>
</ul></li>
<li><p>This pattern may suggest that assortment type ‘b’ is reserved for select stores with greater revenue potential, while ‘a’ and ‘c’ serve as more generalized configurations.</p></li>
</ul>
<section id="distribution-of-assortment-types" class="level4">
<h4 class="anchored" data-anchor-id="distribution-of-assortment-types">Distribution of assortment types</h4>
<div id="3a8beac8" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="31">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>sns.countplot(x<span class="op">=</span><span class="st">'Assortment'</span>, data<span class="op">=</span>df, palette<span class="op">=</span><span class="st">'Set2'</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution of Assortment Types'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>Text(0.5, 1.0, 'Distribution of Assortment Types')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-32-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="sales-by-assortment" class="level4">
<h4 class="anchored" data-anchor-id="sales-by-assortment">Sales by assortment</h4>
<div id="3aa1c676" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="32">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>sns.boxplot(x<span class="op">=</span><span class="st">'Assortment'</span>, y<span class="op">=</span><span class="st">'Sales'</span>, data<span class="op">=</span>df, palette<span class="op">=</span><span class="st">'Set2'</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Sales Distribution by Assortment Type'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>Text(0.5, 1.0, 'Sales Distribution by Assortment Type')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-33-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="average-sales-by-assortment" class="level4">
<h4 class="anchored" data-anchor-id="average-sales-by-assortment">Average sales by assortment</h4>
<div id="c3c877ac" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="33">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span><span class="st">'Assortment'</span>, y<span class="op">=</span><span class="st">'Sales'</span>, data<span class="op">=</span>df, estimator<span class="op">=</span><span class="st">'mean'</span>, ci<span class="op">=</span><span class="st">'sd'</span>, palette<span class="op">=</span><span class="st">'Set2'</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Average Sales by Assortment Type'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>Text(0.5, 1.0, 'Average Sales by Assortment Type')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-34-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="competition-distance" class="level3">
<h3 class="anchored" data-anchor-id="competition-distance">Competition distance</h3>
<ul>
<li><p>These visualizations explore how competition distance varies by store type and how it correlates with sales performance.</p>
<ul>
<li><p>The KDE plot shows that most stores are located close to competitors, regardless of type, though the degree of clustering varies.</p></li>
<li><p>The boxplot confirms this clustering but also reveals that Store Types a, c, and d have wider interquartile ranges and more extreme outliers, suggesting more geographic diversity, including rural or sparsely populated regions.</p></li>
</ul></li>
<li><p>Store Type b is distinct:</p>
<ul>
<li><p>It has a sharp KDE peak near zero and a tight boxplot distribution, indicating consistent placement in areas of dense competition.</p></li>
<li><p>Rather than being negatively affected, these stores may actually benefit from this setup—likely operating in busy commercial zones where high foot traffic and dense retail clusters help drive sales despite proximity to rivals.</p></li>
</ul></li>
<li><p>The scatter plot of Sales vs.&nbsp;Competition Distance further supports this interpretation:</p>
<ul>
<li><p>Stores with very short competition distances achieve high sales figures, reinforcing the idea that being near competitors is actually beneficial.</p></li>
<li><p>This may reflect advantages of urban placement — visibility and foot traffic outweighing the risks of competition.</p></li>
</ul></li>
</ul>
<div id="7a5f93b0" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="34">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>sns.histplot(df[<span class="st">'CompetitionDistance'</span>].dropna(), bins<span class="op">=</span><span class="dv">50</span>, kde<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">'teal'</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution of Competition Distance'</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Distance to Nearest Competitor (meters)'</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Count'</span>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-35-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="2599633b" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="35">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'CompetitionDistance'</span>, hue<span class="op">=</span><span class="st">'StoreType'</span>, common_norm<span class="op">=</span><span class="va">False</span>, fill<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Competition Distance Distribution by Store Type'</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Competition Distance (meters)'</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Density'</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-36-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="ce33c53f" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="36">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>sns.boxplot(x<span class="op">=</span><span class="st">'StoreType'</span>, y<span class="op">=</span><span class="st">'CompetitionDistance'</span>, data<span class="op">=</span>df)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Competition Distance by Store Type'</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Store Type'</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Competition Distance (meters)'</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-37-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="66f0dd05" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="37">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span><span class="st">'CompetitionDistance'</span>, y<span class="op">=</span><span class="st">'Sales'</span>, data<span class="op">=</span>df, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Sales vs. Competition Distance '</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Competition Distance (meters)'</span>)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Sales'</span>)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-38-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="section-5-promotions-and-holidays" class="level1">
<h1>Section 5: Promotions and holidays</h1>
<hr>
<ul>
<li>In this section, we examine how promotional campaigns and holiday schedules—particularly school holidays—impact store sales.</li>
<li>We assess distributional differences, evaluate statistical significance, and explore possible explanations for observed patterns.</li>
<li>This analysis helps identify how external events and marketing efforts influence customer behavior and purchasing volume.</li>
<li>Filtering for only open days ensures that we analyze the effects of these time-related features on days where sales are actually possible.</li>
</ul>
<section id="promo-promo2" class="level2">
<h2 class="anchored" data-anchor-id="promo-promo2">Promo / Promo2</h2>
<section id="distribution-of-promo-promo2-open-days-only" class="level3">
<h3 class="anchored" data-anchor-id="distribution-of-promo-promo2-open-days-only">Distribution of Promo / Promo2 (Open Days Only)</h3>
<ul>
<li><p>The <code>Promo</code> feature (indicating a periodic, short-term promotional event) is active on a significant portion of open days, but not the majority.</p></li>
<li><p>The <code>Promo2</code> feature (a long-term, continuous promotional program) is roughly balanced, with nearly half of the open days showing participation.</p></li>
</ul>
<div id="8edc28ed" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="38">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>promo_cols <span class="op">=</span> [<span class="st">'Promo'</span>, <span class="st">'Promo2'</span>]</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> promo_cols:</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    sns.countplot(x<span class="op">=</span>col, data<span class="op">=</span>df, palette<span class="op">=</span><span class="st">"Set2"</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'Distribution of </span><span class="sc">{</span>col<span class="sc">}</span><span class="ss"> '</span>)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(col)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Count"</span>)</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-39-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-39-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="promo-trends-over-time" class="level3">
<h3 class="anchored" data-anchor-id="promo-trends-over-time">Promo trends over time</h3>
<ul>
<li><p>Promo days (short-term promotional events) show clear fluctuations month-to-month, with noticeable seasonal spikes—particularly in early 2015 suggesting that promotions are timed to specific campaigns or business cycles.</p></li>
<li><p>In contrast, Promo2 (longer-running, scheduled promotions) maintains a much more stable monthly pattern. Apart from a significant drop in mid-2014, the proportion of Promo2 days hovers steadily around 50%, reinforcing its nature as a persistent, programmatic promotion type.</p></li>
</ul>
<div id="6e14eb25" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="39">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Promo plot</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Date'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'Date'</span>])</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>df.set_index(<span class="st">'Date'</span>).resample(<span class="st">'M'</span>)[<span class="st">'Promo'</span>].mean().plot()</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="dv">0</span>, <span class="dv">1</span>)  <span class="co"># Set y-axis to range from 0 to 1</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Monthly Proportion of Promo Days '</span>)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Date'</span>)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Proportion of Days'</span>)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-40-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="a34edfd0" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="40">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Promo2 pot</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>df.set_index(<span class="st">'Date'</span>).resample(<span class="st">'M'</span>)[<span class="st">'Promo2'</span>].mean().plot()</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="dv">0</span>, <span class="dv">1</span>)  <span class="co"># Set y-axis to range from 0 to 1</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Monthly Proportion of Promo2 Days '</span>)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Date'</span>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Proportion of Days'</span>)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-41-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="impact-of-promos-on-sales" class="level3">
<h3 class="anchored" data-anchor-id="impact-of-promos-on-sales">Impact of promos on sales</h3>
<ul>
<li><p>To evaluate how promotions influence store sales on days when stores are open, we compare sales distributions with and without promotions using violin and box plots.</p>
<ul>
<li><p>Promo (Standard Promotion)</p>
<ul>
<li><p>The first violin plot shows a clear shift in the sales distribution between days with Promo = 0 and Promo = 1.</p>
<ul>
<li>Stores running a standard promotion tend to have a higher median sales value and higher IQR, as well as more density for higher sales values, strongly suggesting that the standard promotion is associated with a meaningful boost in sales volume.</li>
</ul></li>
</ul></li>
<li><p>Promo2 (Ongoing Promotion Campaign)</p>
<ul>
<li><p>The boxplot comparing Promo2 = 0 vs Promo2 = 1 shows minimal difference in both median and IQR (interquartile range).</p>
<ul>
<li>While there are outliers in both groups, the central distribution remains largely unchanged. There is a slight difference that suggests sales are actually greater when Promo2 is inactive.</li>
</ul></li>
<li><p>This implies that Promo2, on its own, does not appear to significantly impact daily sales, at least not in a way that’s consistently detectable in the aggregated data.</p></li>
</ul></li>
</ul></li>
</ul>
<div id="51d5b360" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="41">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>sns.violinplot(x<span class="op">=</span><span class="st">'Promo'</span>, y<span class="op">=</span><span class="st">'Sales'</span>, data<span class="op">=</span>df)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Sales Distribution with/without Promo '</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>Text(0.5, 1.0, 'Sales Distribution with/without Promo ')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-42-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="c7576553" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="42">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>sns.boxplot(x<span class="op">=</span><span class="st">'Promo2'</span>, y<span class="op">=</span><span class="st">'Sales'</span>, data<span class="op">=</span>df)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Sales Distribution with/without Promo2 '</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>Text(0.5, 1.0, 'Sales Distribution with/without Promo2 ')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-43-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="c08c09c4" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="43">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Sales'</span>].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>count   844,338.00
mean      6,955.96
std       3,103.82
min          46.00
25%       4,859.00
50%       6,369.00
75%       8,360.00
max      41,551.00
Name: Sales, dtype: float64</code></pre>
</div>
</div>
</section>
<section id="impact-of-promos-on-sales-average-sales" class="level3">
<h3 class="anchored" data-anchor-id="impact-of-promos-on-sales-average-sales">Impact of promos on sales (average sales)</h3>
<ul>
<li>To evaluate the impact of promotional campaigns on sales, we analyze average sales for open stores based on the presence of Promo and Promo2.</li>
<li>Promo (standard promotion) shows a clear positive effect on sales.
<ul>
<li>Average sales with Promo == 1 are significantly higher than when no promotion is active.</li>
<li>This confirms that promotional campaigns are associated with a substantial increase in sales volume.</li>
</ul></li>
<li>Promo2 (alternate promotion) shows a slightly negative effect.
<ul>
<li>Surprisingly, stores with Promo2 == 1 have lower average sales than those without.</li>
<li>However, this inverse effect is modest and may reflect underlying factors such as promotion fatigue, seasonality, or store-specific dynamics.</li>
</ul></li>
</ul>
<div id="9a5ec116" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="44">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">'Promo'</span>)[<span class="st">'Sales'</span>].mean().plot(kind<span class="op">=</span><span class="st">'bar'</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Average Sales with/without Promo '</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>Text(0.5, 1.0, 'Average Sales with/without Promo ')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-45-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="8b023d2c" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="45">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">'Promo2'</span>)[<span class="st">'Sales'</span>].mean().plot(kind<span class="op">=</span><span class="st">'bar'</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Average Sales with/without Promo2 '</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>Text(0.5, 1.0, 'Average Sales with/without Promo2 ')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-46-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="holidays" class="level2">
<h2 class="anchored" data-anchor-id="holidays">Holidays</h2>
<section id="impact-of-state-holidays" class="level3">
<h3 class="anchored" data-anchor-id="impact-of-state-holidays">Impact of state holidays</h3>
<ul>
<li>It is clear that the overwhelming majority of stores are closed on state holidays (~0.1% of data points represent holidays where stores are open). This will be addressed in the ‘Feature Engineering’ section below.</li>
</ul>
<div id="b9ee9d4f" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="46">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>sns.countplot(x<span class="op">=</span>df[<span class="st">'IsStateHoliday'</span>], data<span class="op">=</span>df, palette<span class="op">=</span><span class="st">"Set2"</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of IsStateHoliday '</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'IsStateHoliday'</span>)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Count"</span>)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-47-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="3dcfc4bd" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="47">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"State Holiday Counts "</span>, df[<span class="st">'IsStateHoliday'</span>].value_counts())</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"School Holiday Counts "</span>, df[<span class="st">'IsSchoolHoliday'</span>].value_counts())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>State Holiday Counts  IsStateHoliday
0    843428
1       910
Name: count, dtype: int64
School Holiday Counts  IsSchoolHoliday
0    680893
1    163445
Name: count, dtype: int64</code></pre>
</div>
</div>
</section>
<section id="statistical-test-school-holiday-vs-non-holiday-sales" class="level3">
<h3 class="anchored" data-anchor-id="statistical-test-school-holiday-vs-non-holiday-sales">Statistical Test: School Holiday vs Non-Holiday Sales</h3>
<p>To determine whether sales differ significantly between school holidays and non-holidays, we performed an independent two-sample t-test using <code>scipy.stats.ttest_ind</code>. - We used Welch’s t-test by setting <code>equal_var=False</code>. - A z-test was not used because population standard deviations are unknown. - The sample sizes and standard deviations differ between groups, which violates the assumption of equal variances. - Welch’s t-test does not assume equal variances and adjusts the degrees of freedom accordingly. - Each group contains over 100,000 samples, so the sampling distribution of the mean is approximately normal due to the Central Limit Theorem. - This indicates the t-test is the appropriate choice. - Observations are independent because each row represents a separate store-date combination. - The resulting t-statistic was 34.87 and the p-value was smaller than 1e-250. - This means the difference in average sales between holidays and non-holidays is statistically significant. - We conclude that school holidays are associated with meaningful changes in sales.</p>
<div id="5c8588c7" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="48">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by school holiday status and calculate mean and standard deviation</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>summary_stats <span class="op">=</span> df.groupby(<span class="st">'IsSchoolHoliday'</span>)[<span class="st">'Sales'</span>].agg([<span class="st">'mean'</span>, <span class="st">'std'</span>, <span class="st">'count'</span>]).reset_index()</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the numeric summary</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(summary_stats)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>sales_holiday <span class="op">=</span> df[df[<span class="st">'IsSchoolHoliday'</span>] <span class="op">==</span> <span class="dv">1</span>][<span class="st">'Sales'</span>]</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>sales_non_holiday <span class="op">=</span> df[df[<span class="st">'IsSchoolHoliday'</span>] <span class="op">==</span> <span class="dv">0</span>][<span class="st">'Sales'</span>]</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>t_stat, p_value <span class="op">=</span> ttest_ind(sales_holiday, sales_non_holiday, equal_var<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">T-statistic: </span><span class="sc">{</span>t_stat<span class="sc">:.4f}</span><span class="ss">, P-value: </span><span class="sc">{</span>p_value<span class="sc">:.4e}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   IsSchoolHoliday     mean      std   count
0                0 6,897.21 3,083.39  680893
1                1 7,200.71 3,175.82  163445

T-statistic: 34.8898, P-value: 4.8717e-266</code></pre>
</div>
</div>
</section>
<section id="sales-distribution-on-school-holidays" class="level3">
<h3 class="anchored" data-anchor-id="sales-distribution-on-school-holidays">Sales distribution on school holidays</h3>
<div id="9343720d" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="49">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>custom_palette <span class="op">=</span> [<span class="st">'#b3cde3'</span>, <span class="st">'#fbb4ae'</span>]  </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>sns.boxplot(x<span class="op">=</span><span class="st">'IsSchoolHoliday'</span>, y<span class="op">=</span><span class="st">'Sales'</span>, data<span class="op">=</span>df, palette<span class="op">=</span>custom_palette)</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Sales Distribution: School Holiday vs Non-Holiday '</span>)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Is School Holiday (0 = No, 1 = Yes)'</span>)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Sales'</span>)</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-50-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="average-sales-on-school-holidays" class="level3">
<h3 class="anchored" data-anchor-id="average-sales-on-school-holidays">Average sales on school holidays</h3>
<div id="94ada11b" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="50">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span><span class="st">'IsSchoolHoliday'</span>, y<span class="op">=</span><span class="st">'Sales'</span>, data<span class="op">=</span>df, estimator<span class="op">=</span><span class="st">'mean'</span>, ci<span class="op">=</span><span class="st">'sd'</span>, palette<span class="op">=</span>custom_palette)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Average Sales: School Holiday vs Non-Holiday '</span>)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Is School Holiday (0 = No, 1 = Yes)'</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Average Sales'</span>)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-51-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="section-6-feature-interactions" class="level1">
<h1>Section 6: Feature interactions</h1>
<hr>
<section id="promotional-strategy" class="level2">
<h2 class="anchored" data-anchor-id="promotional-strategy">Promotional strategy</h2>
<section id="promo-storetype---sales-open-days-only" class="level3">
<h3 class="anchored" data-anchor-id="promo-storetype---sales-open-days-only">Promo × StoreType -&gt; Sales (Open Days Only)</h3>
<ul>
<li><p>This boxplot examines how Promo campaigns influence sales on open days only, isolating the effect of promotions from store closures.</p></li>
<li><p>All store types (A, B, C, D) show a similar increase in median sales during promotions (Promo == 1), indicating that promotions have a broad, consistent positive impact across store types.</p>
<ul>
<li><p>Store Type C exhibits the most compact distributions, suggesting more predictable and stable promo-driven performance.</p></li>
<li><p>Store Type B, despite high overall sales, shows the widest spread and substantial overlap between promotional and non-promotional periods. This implies less consistency in promo effectiveness across stores in this group.</p>
<ul>
<li>The substantial variability in Store Type B could be due to store-level differences (e.g., location, size, demographics), and may benefit from more targeted promotional planning.</li>
</ul></li>
</ul></li>
<li><p>These findings support the use of promotions across all store types, but suggest store-specific factors should be considered — particularly for Type B, where outcomes vary most.</p></li>
</ul>
<div id="1fc7217f-5d9b-477d-ab3e-6d7dce976abb" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>sns.boxplot(</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>df, </span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'StoreType'</span>, </span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'Sales'</span>, </span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span><span class="st">'Promo'</span>, </span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>    palette<span class="op">=</span><span class="st">'Blues'</span>  </span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Promo Effect by Store Type'</span>)</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Sales'</span>)</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Store Type'</span>)</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Promo'</span>)</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-52-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="promo-assortment---sales" class="level3">
<h3 class="anchored" data-anchor-id="promo-assortment---sales">Promo × Assortment -&gt; Sales</h3>
<ul>
<li><p>This boxplot analyzes how promotional campaigns (Promo) affect sales across different assortment levels on days when stores are open.</p>
<ul>
<li><p>All assortment levels — basic (a), extra (b), and extended (c) — show a positive shift in median sales during promotion periods (Promo == 1), suggesting that promotions generally improve sales across the board.</p>
<ul>
<li><p>Basic assortment (a) and extended assortment (c) show the clearest and most consistent promo gain, with a noticeable upward shift in the median and limited overlap between promo and non-promo distributions. This indicates that promotions are highly effective in stores with narrow product ranges.</p></li>
<li><p>Extra assortment (b) stores have high baseline sales and show minimal separation between promo and non-promo periods.</p>
<ul>
<li>The variety level of (b) may already be optimal for its customers (a happy medium between the basic and extended assortments), meaning a promotion would only have a limited effect on an already strong level of sales.</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<div id="651307b3-20fe-4987-a93e-db7dbff4e06e" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>sns.boxplot(</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>df, </span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'Assortment'</span>, </span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'Sales'</span>, </span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span><span class="st">'Promo'</span>, </span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>    palette<span class="op">=</span><span class="st">'Blues'</span>  </span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Promo Effect by Assortment Type'</span>)</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Sales'</span>)</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Assortment'</span>)</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Promo'</span>)</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-53-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="promo-dayofweek---sales" class="level3">
<h3 class="anchored" data-anchor-id="promo-dayofweek---sales">Promo × DayOfWeek -&gt; Sales</h3>
<ul>
<li><p>NOTE: No promotional campaigns are recorded on Saturdays or Sundays in the dataset. They are included here to show the general pattern of sales throughout the week.</p></li>
<li><p>The plot shows average sales by day of week, separated by promo status, using only days when stores were open.</p>
<ul>
<li><p>Among weekdays, Monday (Day 0) shows the largest uplift in average sales during promotions.</p></li>
<li><p>Days 1–4 (Tuesday to Friday) also benefit from promos, though the gap is less dramatic.</p></li>
<li><p>Weekends (Days 5–6) show strong baseline sales without any active promotions, with Sunday being the higher-earning day by a significant margin.</p></li>
</ul></li>
</ul>
<div id="647b8a1b-1bd2-4097-9b28-4a886defdf99" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="53">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group and average</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>grouped <span class="op">=</span> df.groupby([<span class="st">'Promo'</span>, <span class="st">'DayOfWeek'</span>])[<span class="st">'Sales'</span>].mean().reset_index()</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>sns.barplot(data<span class="op">=</span>grouped, x<span class="op">=</span><span class="st">'DayOfWeek'</span>, y<span class="op">=</span><span class="st">'Sales'</span>, hue<span class="op">=</span><span class="st">'Promo'</span>, palette<span class="op">=</span><span class="st">'Blues'</span>)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Average Sales by Day of Week and Promo Status'</span>)</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Day of Week (0=Mon, 6=Sun)'</span>)</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Average Sales'</span>)</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Promo'</span>)</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-54-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="promo2-month---sales" class="level3">
<h3 class="anchored" data-anchor-id="promo2-month---sales">Promo2 × Month -&gt; Sales</h3>
<ul>
<li><p>For all months, Promo2 stores underperform compared to non-Promo2 stores in terms of average sales.</p></li>
<li><p>Promo2 strategy might need reevaluation — it appears to be consistently detrimental.</p></li>
</ul>
<div id="bee4f7c0-ee6f-4937-9388-b7b43d1d6e5d" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="54">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group and average sales by Month and Promo2</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>grouped <span class="op">=</span> df.groupby([<span class="st">'Month'</span>, <span class="st">'Promo2'</span>])[<span class="st">'Sales'</span>].mean().reset_index()</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>grouped, x<span class="op">=</span><span class="st">'Month'</span>, y<span class="op">=</span><span class="st">'Sales'</span>, hue<span class="op">=</span><span class="st">'Promo2'</span>, marker<span class="op">=</span><span class="st">'o'</span>, palette<span class="op">=</span><span class="st">'Purples'</span>)</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Average Sales per Month by Promo2 Status'</span>)</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Month'</span>)</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Average Sales'</span>)</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Promo2'</span>)</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-55-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="store-characteristics" class="level2">
<h2 class="anchored" data-anchor-id="store-characteristics">Store characteristics</h2>
<section id="storetype-x-competitiondistance---sales" class="level3">
<h3 class="anchored" data-anchor-id="storetype-x-competitiondistance---sales">StoreType x CompetitionDistance -&gt; Sales</h3>
<ul>
<li><p>This boxplot explores how sales performance varies by store format (a, b, c, d) depending on how close competitors are, using binned CompetitionDistance. Lighter green indicates nearby rivals, while darker green means distant competitors.</p></li>
<li><p>Across all store types, stores tend to perform better when competitors are closer, contrary to typical assumptions:</p>
<ul>
<li><p>The lightest green boxes (closest competition) generally have higher medians than darker shades.</p></li>
<li><p>This suggests proximity may boost foot traffic or place stores in denser commercial zones, rather than harming performance.</p></li>
</ul></li>
<li><p>Store Type b:</p>
<ul>
<li><p>Shows the strongest positive response to nearby competition.</p></li>
<li><p>Median sales drop significantly as distance from competitors increases, with the darkest green (farthest) showing lowest sales.</p></li>
<li><p>Possibly reliant on being clustered with other retailers.</p></li>
</ul></li>
<li><p>Store Types a, c, and d:</p>
<ul>
<li><p>All follow a similar trend—closer competition correlates with higher sales, although less dramatically than Type b.</p></li>
<li><p>Type d has the most similar performance across all distances, indicating it is not an important factor for this store type.</p></li>
</ul></li>
<li><p>Rather than being cannibalized by nearby stores, these formats may be complemented by competitive presence.</p></li>
</ul>
<div id="5c4cc5bf-fc0e-46da-ae10-623b5f877d29" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bin distances</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'CompetitionBin'</span>] <span class="op">=</span> pd.qcut(df[<span class="st">'CompetitionDistance'</span>], q<span class="op">=</span><span class="dv">4</span>, duplicates<span class="op">=</span><span class="st">'drop'</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>sns.boxplot(</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>df, </span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'StoreType'</span>, </span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'Sales'</span>, </span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span><span class="st">'CompetitionBin'</span>, </span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>    palette<span class="op">=</span><span class="st">'Greens'</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Sales by Store Type and Competition Distance'</span>)</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Store Type'</span>)</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Sales'</span>)</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Competition Distance (Binned)'</span>, loc<span class="op">=</span><span class="st">'upper right'</span>)</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(columns<span class="op">=</span>[<span class="st">"CompetitionBin"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-56-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="storetype-x-assortment---sales" class="level3">
<h3 class="anchored" data-anchor-id="storetype-x-assortment---sales">StoreType x Assortment -&gt; Sales</h3>
<ul>
<li><p>NOTE: Assortment b is only available within store type b.</p></li>
<li><p>This boxplot examines how sales distribution varies by store format (StoreType) and assortment strategy (Assortment), providing insight into which combinations deliver stronger performance. Note: Not all combinations are represented—Assortment B only exists within Store Type B. As such, we only compare Assortment B to other assortments within Store Type B, not across other store types.</p></li>
<li><p>Assortment C is the clear winner across all store types.</p></li>
<li><p>Store type b dominates overall:</p>
<ul>
<li><p>Shows the highest median sales among all Store Types.</p></li>
<li><p>The strongest performing combination is store Type b + Assortment c, which leads all groups in median and upper quartile performance by a wide margin.</p></li>
<li><p>Assortment b within store type b performs significantly worse, with notably lower median sales—suggesting this assortment strategy underperforms even within a strong store format.</p></li>
</ul></li>
<li><p>Store types a, c, and d:</p>
<ul>
<li><p>Perform similarly across assortment types, with minimal differences in median sales.</p></li>
<li><p>These formats show broad, flat performance with no standout combinations, indicating they’re possibly less sensitive to assortment variations.</p></li>
</ul></li>
<li><p>All store types (especially a, c, d) exhibit long upper tails, showing that a subset of stores can still achieve high sales regardless of format or assortment.</p></li>
<li><p>Store Type B stands out by combining both high median performance and less spread, which suggests consistent strength, not just a few outlier stores.</p></li>
</ul>
<div id="4ac1d014-f7c6-4bb7-8ada-02b6dca00b78" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a grouped boxplot of Sales by StoreType and Assortment</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>sns.boxplot(</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>df,</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'StoreType'</span>,</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'Sales'</span>,</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span><span class="st">'Assortment'</span>,</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>    palette<span class="op">=</span><span class="st">'Set2'</span>  </span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Sales Distribution by StoreType and Assortment'</span>)</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Store Type'</span>)</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Sales'</span>)</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Assortment'</span>)</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-57-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="assortment-month---sales" class="level3">
<h3 class="anchored" data-anchor-id="assortment-month---sales">Assortment × Month -&gt; Sales</h3>
<ul>
<li><p>NOTE: Assortment b is only available within store type b.</p></li>
<li><p>This line plot shows normalized average sales per store by assortment and month, revealing per-store performance patterns over time.</p>
<ul>
<li><p>Assortment b consistently outperforms a and c across all months, confirming its strength seen in the boxplot (within store type b).</p></li>
<li><p>Assortment c trails behind b, despite appearing stronger in the boxplot. Its wider distribution across store types likely inflates its aggregate presence, not per-store effectiveness.</p></li>
<li><p>Assortment a shows the lowest normalized sales, reaffirming its weak performance across both visualizations.</p></li>
</ul></li>
<li><p>All assortments decline sharply in August, then recover moderately in Q4 — though none return to mid-year highs.</p></li>
</ul>
<div id="8ef7c228" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="57">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create complete Month-Assortment grid</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>all_months <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">13</span>))</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>all_assortments <span class="op">=</span> df[<span class="st">'Assortment'</span>].unique()</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>full_index <span class="op">=</span> pd.MultiIndex.from_product(</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    [all_months, all_assortments],</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>    names<span class="op">=</span>[<span class="st">'Month'</span>, <span class="st">'Assortment'</span>]</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>full_index_df <span class="op">=</span> full_index.to_frame(index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Group original data</span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>sales_per_group <span class="op">=</span> (</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>    df.groupby([<span class="st">'Month'</span>, <span class="st">'Assortment'</span>])</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>        TotalSales<span class="op">=</span>(<span class="st">'Sales'</span>, <span class="st">'sum'</span>),</span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>        StoreCount<span class="op">=</span>(<span class="st">'Store'</span>, <span class="st">'nunique'</span>)</span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with full grid to force missing Month-Assortment combos</span></span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>sales_per_group <span class="op">=</span> (</span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a>    full_index_df</span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a>    .merge(sales_per_group, on<span class="op">=</span>[<span class="st">'Month'</span>, <span class="st">'Assortment'</span>], how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate sales per store</span></span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true" tabindex="-1"></a>sales_per_group[<span class="st">'SalesPerStore'</span>] <span class="op">=</span> sales_per_group[<span class="st">'TotalSales'</span>] <span class="op">/</span> sales_per_group[<span class="st">'StoreCount'</span>]</span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-29"><a href="#cb78-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Define custom color palette </span></span>
<span id="cb78-30"><a href="#cb78-30" aria-hidden="true" tabindex="-1"></a>assortment_palette <span class="op">=</span> {</span>
<span id="cb78-31"><a href="#cb78-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">'a'</span>: <span class="st">'#66c2a5'</span>,  <span class="co"># green</span></span>
<span id="cb78-32"><a href="#cb78-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">'b'</span>: <span class="st">'#8da0cb'</span>,  <span class="co"># blue</span></span>
<span id="cb78-33"><a href="#cb78-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">'c'</span>: <span class="st">'#fc8d62'</span>   <span class="co"># orange</span></span>
<span id="cb78-34"><a href="#cb78-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb78-35"><a href="#cb78-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-36"><a href="#cb78-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder 'Assortment' as categorical to control legend order</span></span>
<span id="cb78-37"><a href="#cb78-37" aria-hidden="true" tabindex="-1"></a>sales_per_group[<span class="st">'Assortment'</span>] <span class="op">=</span> pd.Categorical(</span>
<span id="cb78-38"><a href="#cb78-38" aria-hidden="true" tabindex="-1"></a>    sales_per_group[<span class="st">'Assortment'</span>],</span>
<span id="cb78-39"><a href="#cb78-39" aria-hidden="true" tabindex="-1"></a>    categories<span class="op">=</span>[<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>],</span>
<span id="cb78-40"><a href="#cb78-40" aria-hidden="true" tabindex="-1"></a>    ordered<span class="op">=</span><span class="va">True</span></span>
<span id="cb78-41"><a href="#cb78-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-42"><a href="#cb78-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-43"><a href="#cb78-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb78-44"><a href="#cb78-44" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb78-45"><a href="#cb78-45" aria-hidden="true" tabindex="-1"></a>sns.lineplot(</span>
<span id="cb78-46"><a href="#cb78-46" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>sales_per_group,</span>
<span id="cb78-47"><a href="#cb78-47" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'Month'</span>,</span>
<span id="cb78-48"><a href="#cb78-48" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'SalesPerStore'</span>,</span>
<span id="cb78-49"><a href="#cb78-49" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span><span class="st">'Assortment'</span>,</span>
<span id="cb78-50"><a href="#cb78-50" aria-hidden="true" tabindex="-1"></a>    marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb78-51"><a href="#cb78-51" aria-hidden="true" tabindex="-1"></a>    palette<span class="op">=</span>assortment_palette</span>
<span id="cb78-52"><a href="#cb78-52" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-53"><a href="#cb78-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-54"><a href="#cb78-54" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Normalized Sales per Store by Assortment and Month (Open Days Only)'</span>)</span>
<span id="cb78-55"><a href="#cb78-55" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Month'</span>)</span>
<span id="cb78-56"><a href="#cb78-56" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Average Sales per Store'</span>)</span>
<span id="cb78-57"><a href="#cb78-57" aria-hidden="true" tabindex="-1"></a>plt.xticks(ticks<span class="op">=</span><span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">13</span>), labels<span class="op">=</span>calendar.month_abbr[<span class="dv">1</span>:<span class="dv">13</span>])</span>
<span id="cb78-58"><a href="#cb78-58" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(pad<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb78-59"><a href="#cb78-59" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-58-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="section-7-feature-engineering" class="level1">
<h1>Section 7: Feature engineering</h1>
<hr>
<ul>
<li>This section translates key EDA insights and domain context into model-ready features to improve learning performance and generalization. The engineering efforts fall into three main categories:
<ul>
<li><strong>Continuous variable transformations</strong>
<ul>
<li><strong>Log-transformed <code>Sales</code> and <code>CompetitionDistance</code></strong> – applied <code>log1p()</code> to correct right-skewness and stabilize variance, which benefits tree-based models that rely on meaningful split thresholds.</li>
<li><strong>Store-level average sales (<code>Store_AvgSales</code>)</strong> – captures persistent sales strength of each store to help contextualize daily fluctuations in sales volume.</li>
<li><strong>Label-encoded <code>Month</code></strong> – converts calendar months into integer format for better model compatibility.</li>
<li><strong>Engineered holiday-anticipation feature (<code>IsPreStateHolidayWindow</code>, 3-day window before state holiday)</strong> – designed to detect short-term sales shifts just before holidays. Although ultimately dropped, its creation demonstrates that the issue was considered during feature engineering.</li>
</ul></li>
<li><strong>Interaction-based feature additions</strong>
<ul>
<li>Ordinal scores based on observed promo responsiveness for:
<ul>
<li><strong>StoreType</strong> (<code>promo_storetype_score</code>)</li>
<li><strong>Assortment</strong> (<code>promo_assortment_score</code>)</li>
<li><strong>DayOfWeek</strong> (<code>promo_day_strength</code>)</li>
</ul></li>
<li><strong>Promo2 penalty flag</strong> (<code>promo2_penalty</code>) – captures under-performance linked to Promo2 strategy.</li>
<li>One-hot encoded interaction combos:
<ul>
<li>Promo × StoreType</li>
<li>Promo × Assortment</li>
<li>StoreType × Assortment</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<section id="final-feature-adjustments---continuous-high-cardinality-variables" class="level2">
<h2 class="anchored" data-anchor-id="final-feature-adjustments---continuous-high-cardinality-variables">Final feature adjustments - continuous / high-cardinality variables</h2>
<p>This cell performs final transformations to ensure model-readiness for key numeric and categorical features:</p>
<ul>
<li><p>Log-transform Sales and CompetitionDistance:</p>
<ul>
<li>These variables exhibit heavy right skew. Applying a log(1+x) transformation reduces variance and stabilizes model learning, especially for tree-based regressors sensitive to wide ranges.</li>
</ul></li>
<li><p>Encode Month as an integer:</p>
<ul>
<li>This completes the encoding of the other date-extracted features (Day, Week). The encoding for Month was delayed to facilitate analyses using this feature above, and is done now for modeling purposes.</li>
</ul></li>
</ul>
<div id="43f264e6-0468-4cb5-b309-85055a57b3e8" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="58">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-transform Sales (target)</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Sales'</span>] <span class="op">=</span> np.log1p(df[<span class="st">'Sales'</span>])  <span class="co"># log(1 + x) to handle 0 sales</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-transform CompetitionDistance</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'CompetitionDistance'</span>] <span class="op">=</span> np.log1p(df[<span class="st">'CompetitionDistance'</span>])</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Encode Month column </span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Month'</span>] <span class="op">=</span> le.fit_transform(df[<span class="st">'Month'</span>].astype(<span class="bu">str</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="engineer-isprestateholidaywindow-feature" class="level3">
<h3 class="anchored" data-anchor-id="engineer-isprestateholidaywindow-feature">Engineer IsPreStateHolidayWindow feature</h3>
<ul>
<li><p>As IsStateHoliday gives essentially the same information as Open (the above pots confirm that almost all stores are closed on state holidays), this column by itself isn’t very useful. However, logically the anticipation of holidays can have an impact on customer behavior.</p></li>
<li><p>The new column IsPreStateHolidayWindow flags rows that are within a 3-week (21 day) period before a holiday. This helps us extract useful insight from the IsStateHoliday column without relying on it directly.</p></li>
</ul>
<div id="e70307c4" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="59">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span><span class="st">'IsStateHoliday'</span>, y<span class="op">=</span><span class="st">'Sales'</span>, data<span class="op">=</span>df, estimator<span class="op">=</span><span class="st">'mean'</span>, ci<span class="op">=</span><span class="st">'sd'</span>, palette<span class="op">=</span><span class="st">'Set2'</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Average Sales: (State) Holiday vs Non-Holiday'</span>)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Is Holiday (0 = No, 1 = Yes)'</span>)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Average Sales'</span>)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-60-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="52e927cb-41e8-4931-9fa2-2b5dbf3d1c85" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="60">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by store and date to ensure proper windowing</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.sort_values([<span class="st">'Store'</span>, <span class="st">'Date'</span>])</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the feature</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'IsPreStateHolidayWindow'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Set window length in days</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>pre_holiday_window <span class="op">=</span> <span class="dv">21</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Get holiday dates per store</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>holiday_dates <span class="op">=</span> df[df[<span class="st">'IsStateHoliday'</span>] <span class="op">==</span> <span class="dv">1</span>][[<span class="st">'Store'</span>, <span class="st">'Date'</span>]]</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Build lookup set for speed</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>holiday_lookup <span class="op">=</span> (</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>    holiday_dates</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>    .assign(</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>        Start<span class="op">=</span><span class="kw">lambda</span> d: d[<span class="st">'Date'</span>] <span class="op">-</span> pd.Timedelta(days<span class="op">=</span>pre_holiday_window),</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>        End<span class="op">=</span><span class="kw">lambda</span> d: d[<span class="st">'Date'</span>] <span class="op">-</span> pd.Timedelta(days<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">'Store'</span>)</span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">apply</span>(<span class="kw">lambda</span> grp: <span class="bu">list</span>(<span class="bu">zip</span>(grp[<span class="st">'Start'</span>], grp[<span class="st">'End'</span>])))</span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>    .to_dict()</span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function to check whether a row is within any store's pre-holiday windows</span></span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> is_in_preholiday_window(row):</span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a>    store <span class="op">=</span> row[<span class="st">'Store'</span>]</span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a>    date <span class="op">=</span> row[<span class="st">'Date'</span>]</span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> start, end <span class="kw">in</span> holiday_lookup.get(store, []):</span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> start <span class="op">&lt;=</span> date <span class="op">&lt;=</span> end:</span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-34"><a href="#cb81-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply row-wise</span></span>
<span id="cb81-35"><a href="#cb81-35" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'IsPreStateHolidayWindow'</span>] <span class="op">=</span> df.<span class="bu">apply</span>(is_in_preholiday_window, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="impact-of-pre-holiday-window-21-days-before-a-state-holiday-on-sales" class="level4">
<h4 class="anchored" data-anchor-id="impact-of-pre-holiday-window-21-days-before-a-state-holiday-on-sales">Impact of pre-holiday window (21 days before a state holiday) on Sales</h4>
<div id="e30ac8ae" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="61">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate average sales for each category</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>avg_sales_normal <span class="op">=</span> df[df[<span class="st">'IsPreStateHolidayWindow'</span>] <span class="op">==</span> <span class="dv">0</span>][<span class="st">'Sales'</span>].mean()</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>avg_sales_preholiday <span class="op">=</span> df[df[<span class="st">'IsPreStateHolidayWindow'</span>] <span class="op">==</span> <span class="dv">1</span>][<span class="st">'Sales'</span>].mean()</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Average Sales on Normal Days: </span><span class="sc">{</span>avg_sales_normal<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Average Sales during Pre-Holiday Window: </span><span class="sc">{</span>avg_sales_preholiday<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Average Sales on Normal Days: 8.76
Average Sales during Pre-Holiday Window: 8.89</code></pre>
</div>
</div>
<div id="e316d442" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="62">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>sns.barplot(</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>df,</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'IsPreStateHolidayWindow'</span>,</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'Sales'</span>,</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    estimator<span class="op">=</span><span class="st">'mean'</span>,</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>    ci<span class="op">=</span><span class="st">'sd'</span>,</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>    palette<span class="op">=</span><span class="st">'Set2'</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>plt.xticks([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="st">'Normal Day'</span>, <span class="st">'Pre-Holiday Window'</span>])</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Average Sales: Pre-Holiday Window (State) vs Normal Days'</span>)</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">''</span>)</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Average Sales'</span>)</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-63-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="drop-features-related-to-state-holidays" class="level4">
<h4 class="anchored" data-anchor-id="drop-features-related-to-state-holidays">Drop features related to state holidays</h4>
<ul>
<li><p>Following this analysis, is is obvious that state holidays have no significant effect on sales in this dataset. Almost all holiday days coincide with store closures, and pre-holiday windows show no measurable sales gain. We therefore drop <code>StateHoliday</code>, <code>IsStateHoliday</code>, and <code>IsPreStateHolidayWindow</code> from the final dataset.</p>
<ul>
<li>This makes sense when remembering that Rossmann is a drug store, which is less sensitive to holiday-based increases in demand (people don’t stock up on medications for the holidays).</li>
</ul></li>
</ul>
<div id="8de5f6b3" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="63">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop holiday-related features after confirming they have no predictive value</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>df.drop(columns<span class="op">=</span>[<span class="st">'StateHoliday'</span>, <span class="st">'IsStateHoliday'</span>, <span class="st">'IsPreStateHolidayWindow'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="engineer-activestorecount-feature" class="level3">
<h3 class="anchored" data-anchor-id="engineer-activestorecount-feature">Engineer ActiveStoreCount feature</h3>
<ul>
<li><p>To adjust for variations in the number of reporting stores per day, a new feature, <code>ActiveStoreCount</code>, captures how many stores reported sales on each day and allows us to normalize sales accordingly.</p>
<ul>
<li>This helps mitigate distortions caused by partial data (during closures).</li>
</ul></li>
</ul>
<div id="1c108aef" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="64">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create ActiveStoreCount: number of stores reporting sales on each date</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>active_store_count <span class="op">=</span> (</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>    df</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">'Date'</span>)[<span class="st">'Store'</span>]</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>    .nunique()</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>    .rename(columns<span class="op">=</span>{<span class="st">'Store'</span>: <span class="st">'ActiveStoreCount'</span>})</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge ActiveStoreCount into main dataframe</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.merge(active_store_count, on<span class="op">=</span><span class="st">'Date'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="db84abb4" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="66">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>))</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'Date'</span>, y<span class="op">=</span><span class="st">'ActiveStoreCount'</span>)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Number of Active Stores Reporting per Day'</span>)</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Date'</span>)</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Active Store Count'</span>)</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-66-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="new-features-based-on-interactions" class="level3">
<h3 class="anchored" data-anchor-id="new-features-based-on-interactions">New features based on interactions</h3>
<p>These additions aim to capture sales-driving relationships between promotional activity, store format, product assortment, and temporal factors.</p>
<ul>
<li><strong>Ordinal scores from observed promo sensitivity</strong>
<ul>
<li><code>promo_storetype_score</code>
<ul>
<li>Reflects the observed consistency and strength of promotional effectiveness across different <code>StoreType</code> groups.</li>
</ul></li>
<li><code>promo_assortment_score</code>
<ul>
<li>Scores each assortment level based on responsiveness to promotions.</li>
</ul></li>
<li><code>promo_day_strength</code>
<ul>
<li>Assigns ordinal values to <code>DayOfWeek</code> based on how strongly promotions influenced sales by weekday.</li>
</ul></li>
</ul></li>
<li><strong>Promo2 underperformance indicator</strong>
<ul>
<li><code>promo2_penalty</code>
<ul>
<li>Flags stores currently enrolled in Promo2, which consistently underperformed in the data. Treating this as a negative signal allows the model to down-weight expected gains when <code>Promo2 == 1</code>.</li>
</ul></li>
</ul></li>
<li><strong>One-hot encoded categorical interactions</strong>
<ul>
<li>Each of these interaction terms is one-hot encoded, allowing tree-based models to learn from categorical relationships without introducing noise from rare combinations.</li>
<li><code>promo_x_storetype</code>
<ul>
<li>Captures how different <code>StoreType</code> values respond under promotion (<code>Promo</code>). For example, <code>"1_b"</code> denotes store type b under a promotion.</li>
</ul></li>
<li><code>promo_x_assortment</code>
<ul>
<li>Encodes the relationship between promotional periods and product assortment complexity (<code>Assortment</code>).</li>
</ul></li>
<li><code>store_assortment_combo</code>
<ul>
<li>A direct combination of <code>StoreType</code> and <code>Assortment</code>, designed to capture high-performing format-strategy pairings (example: store type b with assortment b).</li>
</ul></li>
</ul></li>
</ul>
<div id="c25919c9" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="68">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Promo effectiveness by StoreType (ordinal score)</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>promo_storetype_score_map <span class="op">=</span> {</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'a'</span>: <span class="dv">2</span>,  <span class="co"># stable uplift</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'b'</span>: <span class="dv">1</span>,  <span class="co"># high variance</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'c'</span>: <span class="dv">2</span>,</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'d'</span>: <span class="dv">2</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'promo_storetype_score'</span>] <span class="op">=</span> df[<span class="st">'StoreType'</span>].<span class="bu">map</span>(promo_storetype_score_map)</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Promo effectiveness by Assortment (ordinal score)</span></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>promo_assortment_score_map <span class="op">=</span> {</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'a'</span>: <span class="dv">2</span>,  <span class="co"># consistent gain</span></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'b'</span>: <span class="dv">1</span>,  <span class="co"># minimal gain</span></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'c'</span>: <span class="dv">2</span></span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'promo_assortment_score'</span>] <span class="op">=</span> df[<span class="st">'Assortment'</span>].<span class="bu">map</span>(promo_assortment_score_map)</span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Promo effectiveness by DayOfWeek (ordinal score)</span></span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>promo_day_strength_map <span class="op">=</span> {</span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>: <span class="dv">3</span>,  <span class="co"># Monday</span></span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>: <span class="dv">2</span>,</span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>: <span class="dv">1</span>,</span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>: <span class="dv">1</span>,</span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a>    <span class="dv">4</span>: <span class="dv">1</span>,</span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a>    <span class="dv">5</span>: <span class="dv">0</span>,  <span class="co"># Saturday</span></span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a>    <span class="dv">6</span>: <span class="dv">0</span>   <span class="co"># Sunday</span></span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'promo_day_strength'</span>] <span class="op">=</span> df[<span class="st">'DayOfWeek'</span>].<span class="bu">map</span>(promo_day_strength_map)</span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-30"><a href="#cb88-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Promo2 penalty flag — underperformance indicator</span></span>
<span id="cb88-31"><a href="#cb88-31" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'promo2_penalty'</span>] <span class="op">=</span> df[<span class="st">'Promo2'</span>]  <span class="co"># keep as binary 0/1</span></span>
<span id="cb88-32"><a href="#cb88-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-33"><a href="#cb88-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Categorical Interaction Features + One-Hot Encoding</span></span>
<span id="cb88-34"><a href="#cb88-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-35"><a href="#cb88-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Promo × StoreType interaction</span></span>
<span id="cb88-36"><a href="#cb88-36" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'promo_x_storetype'</span>] <span class="op">=</span> df[<span class="st">'Promo'</span>].astype(<span class="bu">str</span>) <span class="op">+</span> <span class="st">"_"</span> <span class="op">+</span> df[<span class="st">'StoreType'</span>]</span>
<span id="cb88-37"><a href="#cb88-37" aria-hidden="true" tabindex="-1"></a>promo_storetype_dummies <span class="op">=</span> pd.get_dummies(df[<span class="st">'promo_x_storetype'</span>], prefix<span class="op">=</span><span class="st">'promo_storetype'</span>)</span>
<span id="cb88-38"><a href="#cb88-38" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.concat([df, promo_storetype_dummies], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb88-39"><a href="#cb88-39" aria-hidden="true" tabindex="-1"></a>df.drop(columns<span class="op">=</span><span class="st">'promo_x_storetype'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb88-40"><a href="#cb88-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-41"><a href="#cb88-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Promo × Assortment interaction</span></span>
<span id="cb88-42"><a href="#cb88-42" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'promo_x_assortment'</span>] <span class="op">=</span> df[<span class="st">'Promo'</span>].astype(<span class="bu">str</span>) <span class="op">+</span> <span class="st">"_"</span> <span class="op">+</span> df[<span class="st">'Assortment'</span>]</span>
<span id="cb88-43"><a href="#cb88-43" aria-hidden="true" tabindex="-1"></a>promo_assortment_dummies <span class="op">=</span> pd.get_dummies(df[<span class="st">'promo_x_assortment'</span>], prefix<span class="op">=</span><span class="st">'promo_assortment'</span>)</span>
<span id="cb88-44"><a href="#cb88-44" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.concat([df, promo_assortment_dummies], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb88-45"><a href="#cb88-45" aria-hidden="true" tabindex="-1"></a>df.drop(columns<span class="op">=</span><span class="st">'promo_x_assortment'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb88-46"><a href="#cb88-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-47"><a href="#cb88-47" aria-hidden="true" tabindex="-1"></a><span class="co"># StoreType × Assortment combo</span></span>
<span id="cb88-48"><a href="#cb88-48" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'store_assortment_combo'</span>] <span class="op">=</span> df[<span class="st">'StoreType'</span>] <span class="op">+</span> <span class="st">"_"</span> <span class="op">+</span> df[<span class="st">'Assortment'</span>]</span>
<span id="cb88-49"><a href="#cb88-49" aria-hidden="true" tabindex="-1"></a>store_assortment_dummies <span class="op">=</span> pd.get_dummies(df[<span class="st">'store_assortment_combo'</span>], prefix<span class="op">=</span><span class="st">'store_assortment'</span>)</span>
<span id="cb88-50"><a href="#cb88-50" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.concat([df, store_assortment_dummies], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb88-51"><a href="#cb88-51" aria-hidden="true" tabindex="-1"></a>df.drop(columns<span class="op">=</span><span class="st">'store_assortment_combo'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="ae17f6fd" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>engineered_features <span class="op">=</span> [</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'promo_assortment_0_a'</span>, <span class="st">'Month'</span>, <span class="st">'store_assortment_a_a'</span>, <span class="st">'promo_storetype_0_a'</span>,</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'promo_assortment_1_a'</span>, <span class="st">'store_assortment_b_c'</span>, <span class="st">'StoreStartDate'</span>, <span class="st">'promo_storetype_1_b'</span>,</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'IsWeekend'</span>, <span class="st">'store_assortment_a_c'</span>, <span class="st">'promo2_penalty'</span>, <span class="st">'promo_storetype_0_d'</span>,</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'promo_storetype_1_d'</span>, <span class="st">'Promo2Start'</span>, <span class="st">'promo_assortment_score'</span>, <span class="st">'Year'</span>,</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'store_assortment_c_c'</span>, <span class="st">'promo_storetype_1_a'</span>, <span class="st">'store_assortment_d_a'</span>, <span class="st">'Week'</span>,</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'store_assortment_b_a'</span>, <span class="st">'promo_assortment_0_b'</span>, <span class="st">'ActiveStoreCount'</span>, <span class="st">'promo_assortment_1_b'</span>,</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'promo_assortment_1_c'</span>, <span class="st">'promo_storetype_1_c'</span>, <span class="st">'Promo2DurationWeeks'</span>, <span class="st">'CompetitionOpenDuration'</span>,</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CompetitionOpenSince'</span>, <span class="st">'store_assortment_d_c'</span>, <span class="st">'store_assortment_b_b'</span>, <span class="st">'promo_storetype_0_c'</span>,</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Day'</span>, <span class="st">'promo_day_strength'</span>, <span class="st">'promo_assortment_0_c'</span>, <span class="st">'promo_storetype_score'</span>,</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'IsSchoolHoliday'</span>, <span class="st">'promo_storetype_0_b'</span>, <span class="st">'store_assortment_c_a'</span></span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Manually assign to categories</span></span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>temporal <span class="op">=</span> [</span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Month"</span>, <span class="st">"Year"</span>, <span class="st">"Week"</span>, <span class="st">"Day"</span>, <span class="st">"IsWeekend"</span>, <span class="st">"StoreStartDate"</span>, <span class="st">"Promo2Start"</span>, <span class="st">"CompetitionOpenSince"</span></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>binary_flags <span class="op">=</span> [</span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"IsSchoolHoliday"</span></span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a>ratios_and_scores <span class="op">=</span> [</span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"promo2_penalty"</span>, <span class="st">"promo_assortment_score"</span>, <span class="st">"promo_day_strength"</span>,</span>
<span id="cb89-25"><a href="#cb89-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"promo_storetype_score"</span>, <span class="st">"ActiveStoreCount"</span>, <span class="st">"Promo2DurationWeeks"</span>, <span class="st">"CompetitionOpenDuration"</span></span>
<span id="cb89-26"><a href="#cb89-26" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb89-27"><a href="#cb89-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-28"><a href="#cb89-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Everything else is assumed to be one-hot/categorical</span></span>
<span id="cb89-29"><a href="#cb89-29" aria-hidden="true" tabindex="-1"></a>remaining <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(engineered_features) <span class="op">-</span> <span class="bu">set</span>(temporal) <span class="op">-</span> <span class="bu">set</span>(binary_flags) <span class="op">-</span> <span class="bu">set</span>(ratios_and_scores))</span>
<span id="cb89-30"><a href="#cb89-30" aria-hidden="true" tabindex="-1"></a>one_hot_encoded <span class="op">=</span> <span class="bu">sorted</span>(remaining)</span>
<span id="cb89-31"><a href="#cb89-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-32"><a href="#cb89-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine in order</span></span>
<span id="cb89-33"><a href="#cb89-33" aria-hidden="true" tabindex="-1"></a>ordered_cols <span class="op">=</span> temporal <span class="op">+</span> binary_flags <span class="op">+</span> ratios_and_scores <span class="op">+</span> one_hot_encoded</span>
<span id="cb89-34"><a href="#cb89-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-35"><a href="#cb89-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Configuration</span></span>
<span id="cb89-36"><a href="#cb89-36" aria-hidden="true" tabindex="-1"></a>target_col <span class="op">=</span> <span class="st">"Sales"</span>          </span>
<span id="cb89-37"><a href="#cb89-37" aria-hidden="true" tabindex="-1"></a>min_corr <span class="op">=</span> <span class="fl">0.02</span>               <span class="co"># Minimum absolute correlation to keep a feature</span></span>
<span id="cb89-38"><a href="#cb89-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-39"><a href="#cb89-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute correlation with target</span></span>
<span id="cb89-40"><a href="#cb89-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure target is in the DataFrame</span></span>
<span id="cb89-41"><a href="#cb89-41" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> target_col <span class="kw">in</span> df.columns, <span class="ss">f"</span><span class="sc">{</span>target_col<span class="sc">}</span><span class="ss"> not found in df.columns"</span></span>
<span id="cb89-42"><a href="#cb89-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-43"><a href="#cb89-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Get correlations of engineered features with the target</span></span>
<span id="cb89-44"><a href="#cb89-44" aria-hidden="true" tabindex="-1"></a>target_corr <span class="op">=</span> df[ordered_cols <span class="op">+</span> [target_col]].corr()[target_col].drop(target_col)</span>
<span id="cb89-45"><a href="#cb89-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-46"><a href="#cb89-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter features with sufficient correlation (absolute value)</span></span>
<span id="cb89-47"><a href="#cb89-47" aria-hidden="true" tabindex="-1"></a>selected_features <span class="op">=</span> target_corr[<span class="bu">abs</span>(target_corr) <span class="op">&gt;=</span> min_corr].index.tolist()</span>
<span id="cb89-48"><a href="#cb89-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-49"><a href="#cb89-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Final correlation matrix of selected features only</span></span>
<span id="cb89-50"><a href="#cb89-50" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> df[selected_features]</span>
<span id="cb89-51"><a href="#cb89-51" aria-hidden="true" tabindex="-1"></a>filtered_corr <span class="op">=</span> filtered_df.corr()</span>
<span id="cb89-52"><a href="#cb89-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-53"><a href="#cb89-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb89-54"><a href="#cb89-54" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb89-55"><a href="#cb89-55" aria-hidden="true" tabindex="-1"></a>sns.heatmap(</span>
<span id="cb89-56"><a href="#cb89-56" aria-hidden="true" tabindex="-1"></a>    filtered_corr,</span>
<span id="cb89-57"><a href="#cb89-57" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span><span class="st">"coolwarm"</span>,</span>
<span id="cb89-58"><a href="#cb89-58" aria-hidden="true" tabindex="-1"></a>    square<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb89-59"><a href="#cb89-59" aria-hidden="true" tabindex="-1"></a>    annot<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb89-60"><a href="#cb89-60" aria-hidden="true" tabindex="-1"></a>    cbar_kws<span class="op">=</span>{<span class="st">"shrink"</span>: <span class="fl">0.8</span>},</span>
<span id="cb89-61"><a href="#cb89-61" aria-hidden="true" tabindex="-1"></a>    xticklabels<span class="op">=</span>selected_features,</span>
<span id="cb89-62"><a href="#cb89-62" aria-hidden="true" tabindex="-1"></a>    yticklabels<span class="op">=</span>selected_features,</span>
<span id="cb89-63"><a href="#cb89-63" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax</span>
<span id="cb89-64"><a href="#cb89-64" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb89-65"><a href="#cb89-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-66"><a href="#cb89-66" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="ss">f"Correlation matrix of engineered features (|corr with </span><span class="sc">{</span>target_col<span class="sc">}</span><span class="ss">| ≥ </span><span class="sc">{</span>min_corr<span class="sc">}</span><span class="ss">)"</span>, pad<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb89-67"><a href="#cb89-67" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(selected_features, rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb89-68"><a href="#cb89-68" aria-hidden="true" tabindex="-1"></a>ax.set_yticklabels(selected_features, rotation<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb89-69"><a href="#cb89-69" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb89-70"><a href="#cb89-70" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_EDA_files/figure-html/cell-68-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="3fbbb028" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="70">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(engineered_features)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>['promo_assortment_0_a', 'Month', 'store_assortment_a_a', 'promo_storetype_0_a', 'promo_assortment_1_a', 'store_assortment_b_c', 'StoreStartDate', 'promo_storetype_1_b', 'IsWeekend', 'store_assortment_a_c', 'promo2_penalty', 'promo_storetype_0_d', 'promo_storetype_1_d', 'Promo2Start', 'promo_assortment_score', 'Year', 'store_assortment_c_c', 'promo_storetype_1_a', 'store_assortment_d_a', 'Week', 'store_assortment_b_a', 'promo_assortment_0_b', 'ActiveStoreCount', 'promo_assortment_1_b', 'promo_assortment_1_c', 'promo_storetype_1_c', 'Promo2DurationWeeks', 'CompetitionOpenDuration', 'CompetitionOpenSince', 'store_assortment_d_c', 'store_assortment_b_b', 'promo_storetype_0_c', 'Day', 'promo_day_strength', 'promo_assortment_0_c', 'promo_storetype_score', 'IsSchoolHoliday', 'promo_storetype_0_b', 'store_assortment_c_a']</code></pre>
</div>
</div>
<div id="957e1135" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}" data-execution_count="71">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Final summary of processed dataset </span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 844338 entries, 0 to 844337
Data columns (total 52 columns):
 #   Column                     Non-Null Count   Dtype         
---  ------                     --------------   -----         
 0   Store                      844338 non-null  int64         
 1   DayOfWeek                  844338 non-null  int64         
 2   Date                       844338 non-null  datetime64[ns]
 3   Sales                      844338 non-null  float64       
 4   Promo                      844338 non-null  int64         
 5   IsSchoolHoliday            844338 non-null  int64         
 6   StoreType                  844338 non-null  string        
 7   Assortment                 844338 non-null  string        
 8   CompetitionDistance        844338 non-null  float64       
 9   CompetitionOpenSinceMonth  844338 non-null  int64         
 10  CompetitionOpenSinceYear   844338 non-null  int64         
 11  Promo2                     844338 non-null  int64         
 12  Promo2SinceWeek            844338 non-null  int64         
 13  Promo2SinceYear            844338 non-null  int64         
 14  Year                       844338 non-null  int64         
 15  Month                      844338 non-null  int64         
 16  Day                        844338 non-null  int64         
 17  Week                       844338 non-null  int64         
 18  IsWeekend                  844338 non-null  int64         
 19  Promo2Start                421046 non-null  datetime64[ns]
 20  Promo2DurationWeeks        844338 non-null  float64       
 21  CompetitionOpenSince       844338 non-null  datetime64[ns]
 22  StoreStartDate             844338 non-null  datetime64[ns]
 23  CompetitionOpenDuration    844338 non-null  int64         
 24  ActiveStoreCount           844338 non-null  int64         
 25  promo_storetype_score      844338 non-null  int64         
 26  promo_assortment_score     844338 non-null  int64         
 27  promo_day_strength         844338 non-null  int64         
 28  promo2_penalty             844338 non-null  int64         
 29  promo_storetype_0_a        844338 non-null  boolean       
 30  promo_storetype_0_b        844338 non-null  boolean       
 31  promo_storetype_0_c        844338 non-null  boolean       
 32  promo_storetype_0_d        844338 non-null  boolean       
 33  promo_storetype_1_a        844338 non-null  boolean       
 34  promo_storetype_1_b        844338 non-null  boolean       
 35  promo_storetype_1_c        844338 non-null  boolean       
 36  promo_storetype_1_d        844338 non-null  boolean       
 37  promo_assortment_0_a       844338 non-null  boolean       
 38  promo_assortment_0_b       844338 non-null  boolean       
 39  promo_assortment_0_c       844338 non-null  boolean       
 40  promo_assortment_1_a       844338 non-null  boolean       
 41  promo_assortment_1_b       844338 non-null  boolean       
 42  promo_assortment_1_c       844338 non-null  boolean       
 43  store_assortment_a_a       844338 non-null  boolean       
 44  store_assortment_a_c       844338 non-null  boolean       
 45  store_assortment_b_a       844338 non-null  boolean       
 46  store_assortment_b_b       844338 non-null  boolean       
 47  store_assortment_b_c       844338 non-null  boolean       
 48  store_assortment_c_a       844338 non-null  boolean       
 49  store_assortment_c_c       844338 non-null  boolean       
 50  store_assortment_d_a       844338 non-null  boolean       
 51  store_assortment_d_c       844338 non-null  boolean       
dtypes: boolean(23), datetime64[ns](4), float64(3), int64(20), string(2)
memory usage: 223.9 MB</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<hr>
<p>With the exploratory data analysis complete, we now have a well-understood, cleaned, and feature-engineered dataset ready for modeling.</p>
<ul>
<li><p>Key insights include strong temporal trends, meaningful interactions between assortment types and store formats, and potential benefits from proximity to competitors.</p></li>
<li><p>Anomalies and missing values have been addressed systematically, continuous features have been transformed to mitigate outlier effects, and new features have been created to capture business-relevant patterns.</p></li>
<li><p>We now proceed to the modeling phase in <strong>02_Modeling.ipynb</strong>.</p></li>
</ul>
<section id="export-processed-dataset-for-modeling" class="level2">
<h2 class="anchored" data-anchor-id="export-processed-dataset-for-modeling">Export processed dataset for modeling</h2>
<div id="d68e8f50" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;source_hidden&quot;:true}}">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export cleaned DataFrame for modeling</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">"../data/data_processed.csv"</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>